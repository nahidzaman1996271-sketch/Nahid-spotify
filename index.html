<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Music Player üéµ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,700&display=swap" rel="stylesheet">
    <style>
        :root{--bg:#0a0a0a;--sidebar-bg:#111111;--card-bg:#181818;--card-hover:#282828;--green:#1DB954;--green-glow:rgba(29,185,84,0.3);--pink:#ff6b9d;--pink-glow:rgba(255,107,157,0.3);--text:#FFFFFF;--text-muted:#A7A7A7;--text-faint:#535353;--border:rgba(255,255,255,0.08);--progress-bg:#4d4d4d;}
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
        html,body{height:100%;overflow:hidden;}
        body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);display:flex;flex-direction:column;user-select:none;-webkit-user-select:none;}
        .app{display:flex;flex:1;overflow:hidden;gap:8px;padding:8px;padding-bottom:0;}
        .sidebar{width:290px;flex-shrink:0;background:var(--sidebar-bg);border-radius:12px;display:flex;flex-direction:column;overflow:hidden;}
        .sidebar-header{padding:18px 18px 14px;border-bottom:1px solid var(--border);}
        .sidebar-logo{display:flex;align-items:center;gap:10px;margin-bottom:16px;}
        .logo-icon{width:34px;height:34px;background:var(--green);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.95rem;color:#000;}
        .logo-text{font-weight:700;font-size:1.05rem;}
        .sidebar-search{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.07);border:1px solid var(--border);border-radius:8px;padding:8px 12px;margin-bottom:12px;transition:border-color .2s,background .2s;}
        .sidebar-search:focus-within{border-color:rgba(255,255,255,0.25);background:rgba(255,255,255,0.1);}
        .sidebar-search i{color:var(--text-muted);font-size:.82rem;flex-shrink:0;}
        .sidebar-search input{background:none;border:none;outline:none;color:var(--text);font-family:'DM Sans',sans-serif;font-size:.83rem;width:100%;}
        .sidebar-search input::placeholder{color:var(--text-faint);}
        .s-clear{background:none;border:none;cursor:pointer;color:var(--text-muted);font-size:.78rem;padding:2px;display:none;}
        .s-clear.show{display:block;}
        .sidebar-nav{display:flex;flex-direction:column;gap:3px;}
        .nav-item{display:flex;align-items:center;gap:12px;padding:9px 10px;border-radius:8px;color:var(--text-muted);cursor:pointer;transition:color .2s,background .2s;font-size:.86rem;font-weight:500;}
        .nav-item:hover{color:var(--text);background:rgba(255,255,255,0.05);}
        .nav-item.active{color:var(--text);background:rgba(255,255,255,0.07);}
        .nav-item i{width:18px;text-align:center;font-size:.95rem;}
        .nav-item.pakhiii-nav.active{color:var(--pink);background:rgba(255,107,157,0.08);}
        .nav-item.pakhiii-nav:hover{color:var(--pink);background:rgba(255,107,157,0.06);}
        .nav-badge{margin-left:auto;background:var(--green);color:#000;font-size:.62rem;font-weight:700;padding:1px 6px;border-radius:10px;display:none;}
        .nav-badge.show{display:block;}
        .nav-badge.pink{background:var(--pink);color:#fff;}
        .sidebar-section{padding:14px 18px 6px;display:flex;align-items:center;justify-content:space-between;}
        .sidebar-section-title{font-size:.68rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--text-faint);}
        .count-badge{font-size:.65rem;color:var(--green);font-weight:600;background:rgba(29,185,84,0.1);border:1px solid rgba(29,185,84,0.25);padding:2px 7px;border-radius:20px;display:none;}
        .count-badge.show{display:block;}
        .sidebar-list{flex:1;overflow-y:auto;padding:0 8px 8px;}
        .sidebar-list::-webkit-scrollbar{width:3px;}
        .sidebar-list::-webkit-scrollbar-thumb{background:var(--text-faint);border-radius:3px;}
        .no-results{padding:28px 16px;text-align:center;color:var(--text-muted);font-size:.82rem;display:none;}
        .no-results.show{display:block;}
        .no-results i{display:block;font-size:1.8rem;margin-bottom:8px;color:var(--text-faint);}
        .sidebar-track{display:flex;align-items:center;gap:10px;padding:7px 10px;border-radius:8px;cursor:pointer;transition:background .15s;}
        .sidebar-track:hover{background:rgba(255,255,255,0.06);}
        .sidebar-track.active{background:rgba(255,255,255,0.1);}
        .sidebar-track.hidden{display:none;}
        .s-num{width:18px;text-align:center;font-size:.78rem;color:var(--text-muted);flex-shrink:0;position:relative;height:18px;display:flex;align-items:center;justify-content:center;}
        .s-num-val{transition:opacity .15s;}
        .sidebar-track.active .s-num-val{opacity:0;}
        .playing-bars{position:absolute;display:none;align-items:flex-end;gap:2px;height:14px;}
        .sidebar-track.active .playing-bars{display:flex;}
        .playing-bars span{width:3px;background:var(--green);border-radius:2px;animation:barBounce .75s ease-in-out infinite;}
        .playing-bars span:nth-child(1){height:5px;animation-delay:0s;}
        .playing-bars span:nth-child(2){height:9px;animation-delay:.12s;}
        .playing-bars span:nth-child(3){height:7px;animation-delay:.25s;}
        @keyframes barBounce{0%,100%{transform:scaleY(0.4)}50%{transform:scaleY(1.2)}}
        .paused-state .playing-bars span{animation-play-state:paused;}
        .s-art{width:36px;height:36px;border-radius:6px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:1.2rem;}
        .s-info{flex:1;min-width:0;}
        .s-name{font-size:.82rem;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
        .sidebar-track.active .s-name{color:var(--green);}
        .s-artist{font-size:.72rem;color:var(--text-muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:1px;}
        .s-dur{font-size:.72rem;color:var(--text-muted);flex-shrink:0;}
        .main{flex:1;background:var(--sidebar-bg);border-radius:12px;display:flex;flex-direction:column;overflow:hidden;}
        .playlist-hero{display:flex;gap:24px;align-items:flex-end;padding:24px 24px 20px;position:relative;overflow:hidden;flex-shrink:0;}
        .playlist-hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 30% 50%,rgba(29,185,84,0.13),transparent 60%);}
        .playlist-hero.pakhiii-hero::before{background:radial-gradient(ellipse at 30% 50%,rgba(255,107,157,0.18),transparent 60%);}
        .hero-bg-home{background:linear-gradient(180deg,#1a3a2a 0%,var(--sidebar-bg) 100%);}
        .hero-bg-liked{background:linear-gradient(180deg,#3a1a2a 0%,var(--sidebar-bg) 100%);}
        .hero-bg-queue{background:linear-gradient(180deg,#1a2a3a 0%,var(--sidebar-bg) 100%);}
        .hero-bg-pakhiii{background:linear-gradient(180deg,#3a1a2e 0%,var(--sidebar-bg) 100%);}
        .hero-art{width:150px;height:150px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:4rem;box-shadow:0 16px 50px rgba(0,0,0,0.6);flex-shrink:0;position:relative;z-index:1;}
        .hero-art-home{background:linear-gradient(135deg,#1a6b3a,#0d3d21);}
        .hero-art-liked{background:linear-gradient(135deg,#8b1a3a,#4a0d20);}
        .hero-art-queue{background:linear-gradient(135deg,#1a3a6b,#0d2040);}
        .hero-art-pakhiii{background:linear-gradient(135deg,#8b1a5a,#4a0d30);box-shadow:0 16px 50px rgba(255,107,157,0.35);}
        .hero-info{position:relative;z-index:1;min-width:0;}
        .hero-type{font-size:.72rem;font-weight:700;letter-spacing:.06em;text-transform:uppercase;margin-bottom:8px;}
        .hero-title{font-size:2.8rem;font-weight:700;line-height:1.05;margin-bottom:10px;letter-spacing:-.03em;}
        .hero-title.pakhiii-title{background:linear-gradient(135deg,#ff6b9d,#ffb3d1);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
        .hero-sub{font-size:.84rem;color:var(--text-muted);}
        .hero-sub span{color:var(--text);font-weight:500;}
        .controls-bar{display:flex;align-items:center;gap:14px;padding:16px 24px 12px;flex-shrink:0;flex-wrap:wrap;}
        .play-all-btn{width:52px;height:52px;border-radius:50%;border:none;background:var(--green);color:#000;font-size:1.3rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:transform .15s,background .15s;box-shadow:0 6px 20px var(--green-glow);flex-shrink:0;}
        .play-all-btn:hover{transform:scale(1.06);background:#1ed760;}
        .play-all-btn.pakhiii-play{background:var(--pink);box-shadow:0 6px 20px var(--pink-glow);}
        .play-all-btn.pakhiii-play:hover{background:#ff8ab5;}
        .icon-btn{background:none;border:none;cursor:pointer;color:var(--text-muted);font-size:1.35rem;transition:color .2s,transform .2s;padding:4px;}
        .icon-btn:hover{color:var(--text);transform:scale(1.08);}
        .icon-btn.active{color:var(--green);}
        .sleep-countdown{font-size:.72rem;color:#ff9632;font-weight:600;display:none;background:rgba(255,150,50,0.1);border:1px solid rgba(255,150,50,0.3);padding:3px 8px;border-radius:6px;}
        .sleep-countdown.show{display:block;}
        .main-search{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.07);border:1px solid var(--border);border-radius:8px;padding:8px 12px;margin-left:auto;min-width:180px;transition:border-color .2s,background .2s,min-width .25s;}
        .main-search:focus-within{border-color:rgba(255,255,255,0.25);background:rgba(255,255,255,0.1);min-width:230px;}
        .main-search i{color:var(--text-muted);font-size:.82rem;flex-shrink:0;}
        .main-search input{background:none;border:none;outline:none;color:var(--text);font-family:'DM Sans',sans-serif;font-size:.83rem;width:100%;}
        .main-search input::placeholder{color:var(--text-faint);}
        .track-list-header{display:grid;grid-template-columns:38px 1fr 160px 36px 64px;gap:10px;padding:4px 24px 8px;border-bottom:1px solid var(--border);font-size:.7rem;font-weight:600;letter-spacing:.07em;text-transform:uppercase;color:var(--text-faint);flex-shrink:0;}
        .track-list{flex:1;overflow-y:auto;padding:6px 0;}
        .track-list::-webkit-scrollbar{width:5px;}
        .track-list::-webkit-scrollbar-thumb{background:var(--text-faint);border-radius:5px;}
        .track-row{display:grid;grid-template-columns:38px 1fr 160px 36px 64px;gap:10px;padding:8px 24px;border-radius:6px;cursor:pointer;transition:background .12s;align-items:center;margin:0 8px;}
        .track-row:hover{background:var(--card-hover);}
        .track-row.active{background:rgba(29,185,84,0.12);}
        .track-row.hidden{display:none;}
        .t-idx{font-size:.84rem;color:var(--text-muted);text-align:center;position:relative;display:flex;align-items:center;justify-content:center;height:20px;}
        .track-row.active .t-idx{color:var(--green);}
        .t-idx-num{transition:opacity .12s;}
        .track-row:hover .t-idx-num{opacity:0;}
        .t-play-ico{position:absolute;opacity:0;font-size:.85rem;color:var(--text);transition:opacity .12s;}
        .track-row:hover .t-play-ico{opacity:1;}
        .t-main{display:flex;align-items:center;gap:12px;min-width:0;}
        .t-art{width:40px;height:40px;border-radius:4px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:1.4rem;}
        .t-name{font-size:.88rem;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
        .track-row.active .t-name{color:var(--green);}
        .t-artist{font-size:.75rem;color:var(--text-muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px;}
        .t-album{font-size:.78rem;color:var(--text-muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
        .t-like{background:none;border:none;cursor:pointer;color:transparent;font-size:.85rem;display:flex;align-items:center;justify-content:center;transition:color .15s;}
        .track-row:hover .t-like{color:var(--text-muted);}
        .t-like.liked{color:var(--green)!important;}
        .t-dur{font-size:.78rem;color:var(--text-muted);text-align:right;}
        .empty-badge{display:inline-block;background:rgba(29,185,84,0.1);border:1px solid rgba(29,185,84,0.25);color:var(--green);font-size:.6rem;letter-spacing:.07em;text-transform:uppercase;padding:1px 6px;border-radius:4px;margin-left:6px;font-weight:600;}
        .liked-empty{display:none;flex-direction:column;align-items:center;justify-content:center;flex:1;gap:16px;color:var(--text-muted);padding:40px;text-align:center;}
        .liked-empty.show{display:flex;}
        .liked-empty i{font-size:3.5rem;color:var(--text-faint);}
        .liked-empty h3{font-size:1.1rem;color:var(--text);font-weight:600;}
        .liked-empty p{font-size:.84rem;line-height:1.5;}
        .liked-empty-btn{background:var(--green);color:#000;border:none;padding:10px 24px;border-radius:20px;font-size:.85rem;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;transition:background .15s;}
        .liked-empty-btn:hover{background:#1ed760;}
        .queue-list{flex:1;overflow-y:auto;padding:6px 0;display:none;}
        .queue-list::-webkit-scrollbar{width:5px;}
        .queue-list::-webkit-scrollbar-thumb{background:var(--text-faint);border-radius:5px;}
        .queue-item{display:flex;align-items:center;gap:12px;padding:8px 24px;cursor:pointer;transition:background .12s;border-radius:6px;margin:0 8px;}
        .queue-item:hover{background:var(--card-hover);}
        .queue-item.now{background:rgba(29,185,84,0.12);}
        .queue-item.now .qi-name{color:var(--green);}
        .qi-pos{font-size:.75rem;color:var(--text-faint);width:26px;text-align:center;flex-shrink:0;}
        .qi-art{width:38px;height:38px;border-radius:4px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:1.3rem;}
        .qi-info{flex:1;min-width:0;}
        .qi-name{font-size:.85rem;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
        .qi-artist{font-size:.73rem;color:var(--text-muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:1px;}
        .qi-dur{font-size:.73rem;color:var(--text-muted);flex-shrink:0;}
        .queue-empty{display:none;flex-direction:column;align-items:center;justify-content:center;flex:1;gap:12px;color:var(--text-muted);padding:40px;text-align:center;font-size:.88rem;}
        .queue-empty.show{display:flex;}
        .queue-empty i{font-size:3rem;color:var(--text-faint);}

        /* ‚ïê‚ïê PAKHIII'S CHOICE ‚ïê‚ïê */
        .pakhiii-list{flex:1;overflow-y:auto;padding:6px 0;display:none;}
        .pakhiii-list::-webkit-scrollbar{width:5px;}
        .pakhiii-list::-webkit-scrollbar-thumb{background:rgba(255,107,157,0.3);border-radius:5px;}
        .pakhiii-empty{display:none;flex-direction:column;align-items:center;justify-content:center;flex:1;gap:16px;color:var(--text-muted);padding:40px;text-align:center;}
        .pakhiii-empty.show{display:flex;}
        .pakhiii-empty .pakhiii-heart{font-size:3.5rem;}
        .pakhiii-empty h3{font-size:1.1rem;color:var(--text);font-weight:600;}
        .pakhiii-empty p{font-size:.84rem;line-height:1.5;max-width:280px;}
        .pakhiii-add-bar{display:flex;align-items:center;gap:10px;padding:12px 24px;border-bottom:1px solid var(--border);flex-shrink:0;background:rgba(255,107,157,0.04);}
        .pakhiii-add-bar.hidden-bar{display:none;}
        .pakhiii-add-inp{flex:1;background:rgba(255,255,255,0.07);border:1px solid rgba(255,107,157,0.25);border-radius:8px;padding:9px 14px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:.84rem;outline:none;transition:border-color .2s;}
        .pakhiii-add-inp:focus{border-color:var(--pink);background:rgba(255,107,157,0.06);}
        .pakhiii-add-inp::placeholder{color:var(--text-faint);}
        .pakhiii-add-btn{background:var(--pink);color:#fff;border:none;border-radius:8px;padding:9px 18px;font-size:.82rem;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;transition:background .15s;white-space:nowrap;}
        .pakhiii-add-btn:hover{background:#ff8ab5;}
        .pakhiii-track-row{display:grid;grid-template-columns:38px 1fr 36px 64px;gap:10px;padding:8px 24px;border-radius:6px;cursor:pointer;transition:background .12s;align-items:center;margin:0 8px;}
        .pakhiii-track-row:hover{background:var(--card-hover);}
        .pakhiii-track-row.active{background:rgba(255,107,157,0.12);}
        .pakhiii-track-row.active .t-name{color:var(--pink);}
        .pakhiii-track-row.active .t-idx{color:var(--pink);}
        .pakhiii-track-row .t-remove{background:none;border:none;cursor:pointer;color:transparent;font-size:.85rem;display:flex;align-items:center;justify-content:center;transition:color .15s;}
        .pakhiii-track-row:hover .t-remove{color:var(--text-muted);}
        .pakhiii-track-row .t-remove:hover{color:#ff4444!important;}
        .pakhiii-heart-badge{display:inline-block;background:rgba(255,107,157,0.1);border:1px solid rgba(255,107,157,0.3);color:var(--pink);font-size:.6rem;letter-spacing:.07em;text-transform:uppercase;padding:1px 6px;border-radius:4px;margin-left:6px;font-weight:600;}
        .pakhiii-add-list{max-height:280px;overflow-y:auto;position:absolute;top:100%;left:24px;right:24px;background:#1e1e1e;border:1px solid rgba(255,107,157,0.25);border-radius:10px;z-index:50;display:none;box-shadow:0 10px 40px rgba(0,0,0,0.6);}
        .pakhiii-add-list.show{display:block;}
        .pakhiii-add-list::-webkit-scrollbar{width:3px;}
        .pakhiii-add-list::-webkit-scrollbar-thumb{background:rgba(255,107,157,0.3);border-radius:3px;}
        .pakhiii-suggest-item{display:flex;align-items:center;gap:10px;padding:10px 14px;cursor:pointer;transition:background .12s;}
        .pakhiii-suggest-item:hover{background:rgba(255,107,157,0.08);}
        .pakhiii-suggest-art{width:34px;height:34px;border-radius:5px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:1.1rem;}
        .pakhiii-suggest-name{font-size:.83rem;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
        .pakhiii-suggest-artist{font-size:.72rem;color:var(--text-muted);}
        .pakhiii-add-wrap{position:relative;flex:1;}
        .pakhiii-pin-banner{display:flex;align-items:center;gap:10px;padding:10px 24px;background:linear-gradient(90deg,rgba(255,107,157,0.08),transparent);border-bottom:1px solid rgba(255,107,157,0.1);flex-shrink:0;}
        .pakhiii-pin-banner.hidden-bar{display:none;}
        .pakhiii-pin-avatar{width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,var(--pink),#ff8ab5);display:flex;align-items:center;justify-content:center;font-size:.85rem;flex-shrink:0;}
        .pakhiii-pin-text{font-size:.78rem;color:var(--text-muted);}
        .pakhiii-pin-text strong{color:var(--pink);}

        .eq-panel{position:fixed;bottom:100px;right:20px;background:#1c1c1c;border:1px solid var(--border);border-radius:16px;padding:20px;z-index:400;display:none;width:310px;box-shadow:0 20px 60px rgba(0,0,0,0.7);}
        .eq-panel.open{display:block;}
        .panel-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;}
        .panel-title{font-size:.9rem;font-weight:700;}
        .panel-close{background:none;border:none;cursor:pointer;color:var(--text-muted);font-size:1rem;transition:color .2s;}
        .panel-close:hover{color:var(--text);}
        .eq-presets{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px;}
        .eq-preset{background:rgba(255,255,255,0.07);border:1px solid var(--border);border-radius:20px;padding:5px 12px;font-size:.72rem;font-weight:600;cursor:pointer;color:var(--text-muted);transition:all .2s;font-family:'DM Sans',sans-serif;}
        .eq-preset:hover{color:var(--text);}
        .eq-preset.active{background:rgba(29,185,84,0.15);border-color:var(--green);color:var(--green);}
        .eq-bands{display:flex;gap:6px;justify-content:space-between;align-items:center;}
        .eq-band{display:flex;flex-direction:column;align-items:center;gap:4px;flex:1;}
        .eq-band label{font-size:.6rem;color:var(--text-faint);text-align:center;}
        .eq-slider-wrap{height:90px;display:flex;align-items:center;justify-content:center;}
        input[type=range].eq-sl{-webkit-appearance:none;appearance:none;width:88px;height:4px;background:var(--progress-bg);border-radius:4px;transform:rotate(-90deg);cursor:pointer;outline:none;}
        input[type=range].eq-sl::-webkit-slider-thumb{-webkit-appearance:none;width:13px;height:13px;border-radius:50%;background:var(--green);cursor:pointer;}
        input[type=range].eq-sl::-moz-range-thumb{width:13px;height:13px;border-radius:50%;background:var(--green);cursor:pointer;border:none;}
        .eq-val{font-size:.62rem;color:var(--green);font-weight:700;min-width:28px;text-align:center;}
        .sleep-panel{position:fixed;bottom:100px;left:50%;transform:translateX(-50%);background:#1c1c1c;border:1px solid var(--border);border-radius:16px;padding:20px;z-index:400;display:none;width:260px;box-shadow:0 20px 60px rgba(0,0,0,0.7);}
        .sleep-panel.open{display:block;}
        .sleep-options{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px;}
        .sleep-opt{background:rgba(255,255,255,0.07);border:1px solid var(--border);border-radius:10px;padding:10px;text-align:center;cursor:pointer;font-size:.8rem;font-weight:500;color:var(--text-muted);transition:all .2s;font-family:'DM Sans',sans-serif;}
        .sleep-opt:hover{color:#ff9632;border-color:rgba(255,150,50,0.4);}
        .sleep-opt.active{background:rgba(255,150,50,0.12);border-color:rgba(255,150,50,0.5);color:#ff9632;}
        .sleep-cancel{width:100%;background:rgba(255,255,255,0.06);border:1px solid var(--border);border-radius:10px;padding:8px;text-align:center;cursor:pointer;font-size:.8rem;color:var(--text-muted);font-family:'DM Sans',sans-serif;transition:all .2s;}
        .sleep-cancel:hover{color:var(--text);}
        .player-bar{background:#0f0f0f;border-top:1px solid var(--border);padding:10px 18px;display:grid;grid-template-columns:1fr 2fr 1fr;align-items:center;gap:14px;flex-shrink:0;height:88px;}
        .now-playing{display:flex;align-items:center;gap:12px;min-width:0;}
        .now-art{width:52px;height:52px;border-radius:6px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:1.9rem;background:var(--card-bg);}
        .now-info{min-width:0;flex:1;}
        .now-name{font-size:.82rem;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
        .now-artist{font-size:.72rem;color:var(--text-muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px;}
        .now-like{background:none;border:none;cursor:pointer;color:var(--text-faint);font-size:.95rem;flex-shrink:0;transition:color .15s;padding:4px;}
        .now-like:hover{color:var(--text);}
        .now-like.liked{color:var(--green)!important;}
        .center-controls{display:flex;flex-direction:column;align-items:center;gap:6px;}
        .ctrl-btns{display:flex;align-items:center;gap:18px;}
        .ctrl-btn{background:none;border:none;cursor:pointer;color:var(--text-muted);font-size:.95rem;transition:color .15s,transform .15s;padding:4px;}
        .ctrl-btn:hover{color:var(--text);transform:scale(1.08);}
        .ctrl-btn.active{color:var(--green);}
        .play-pause-btn{width:32px;height:32px;border-radius:50%;border:none;background:var(--text);color:#000;font-size:.85rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:transform .15s;}
        .play-pause-btn:hover{transform:scale(1.08);}
        .progress-row{display:flex;align-items:center;gap:8px;width:100%;}
        .time-lbl{font-size:.68rem;color:var(--text-muted);flex-shrink:0;min-width:34px;}
        .time-lbl.right{text-align:right;}
        .prog-track{flex:1;height:4px;background:var(--progress-bg);border-radius:4px;cursor:pointer;position:relative;transition:height .15s;}
        .prog-track:hover{height:6px;}
        .prog-fill{height:100%;background:var(--text);border-radius:4px;width:0%;pointer-events:none;transition:background .2s;}
        .prog-track:hover .prog-fill{background:var(--green);}
        .prog-thumb{width:12px;height:12px;background:var(--text);border-radius:50%;position:absolute;top:50%;transform:translate(-50%,-50%);left:0%;pointer-events:none;opacity:0;transition:opacity .15s;}
        .prog-track:hover .prog-thumb{opacity:1;}
        .right-controls{display:flex;align-items:center;justify-content:flex-end;gap:10px;}
        .vol-row{display:flex;align-items:center;gap:7px;}
        .vol-btn{background:none;border:none;cursor:pointer;color:var(--text-muted);font-size:.82rem;transition:color .15s;}
        .vol-btn:hover{color:var(--text);}
        .vol-track{width:85px;height:4px;background:var(--progress-bg);border-radius:4px;cursor:pointer;position:relative;}
        .vol-fill{height:100%;background:var(--text);border-radius:4px;width:70%;pointer-events:none;}
        .mode-badge{font-size:.68rem;color:var(--green);font-weight:600;background:rgba(29,185,84,0.12);border:1px solid rgba(29,185,84,0.3);padding:2px 8px;border-radius:4px;display:none;}
        .mode-badge.show{display:inline-block;}
        .color-1{background:linear-gradient(135deg,#1a3a6a,#0d2040)}.color-2{background:linear-gradient(135deg,#6a1a3a,#400d20)}
        .color-3{background:linear-gradient(135deg,#6a3a1a,#40200d)}.color-4{background:linear-gradient(135deg,#1a6a3a,#0d4020)}
        .color-5{background:linear-gradient(135deg,#3a1a6a,#200d40)}.color-6{background:linear-gradient(135deg,#6a6a1a,#40400d)}
        .color-7{background:linear-gradient(135deg,#1a5a6a,#0d3540)}.color-8{background:linear-gradient(135deg,#6a1a6a,#40004a)}
        .color-9{background:linear-gradient(135deg,#2a6a1a,#154010)}.color-10{background:linear-gradient(135deg,#6a2a1a,#401510)}
        .mobile-nav{display:none;background:#0f0f0f;border-top:1px solid var(--border);height:58px;flex-shrink:0;align-items:center;justify-content:space-around;padding:0 4px;}
        .mob-nav-btn{background:none;border:none;cursor:pointer;color:var(--text-muted);display:flex;flex-direction:column;align-items:center;gap:3px;padding:6px 10px;border-radius:8px;transition:color .2s;position:relative;}
        .mob-nav-btn i{font-size:1.05rem;}
        .mob-nav-btn span{font-size:.6rem;font-family:'DM Sans',sans-serif;}
        .mob-nav-btn.active{color:var(--green);}
        .mob-nav-btn.pakhiii-mob.active{color:var(--pink);}
        .mob-dot{position:absolute;top:4px;right:8px;width:7px;height:7px;background:var(--green);border-radius:50%;display:none;}
        .mob-dot.show{display:block;}
        .mob-dot.pink{background:var(--pink);}
        .mob-overlay{display:none;position:fixed;inset:0;background:var(--sidebar-bg);z-index:100;flex-direction:column;padding:16px;}
        .mob-overlay.open{display:flex;}
        .mob-overlay-header{display:flex;align-items:center;gap:12px;margin-bottom:16px;flex-shrink:0;}
        .mob-back{background:none;border:none;cursor:pointer;color:var(--text);font-size:1.1rem;padding:6px;}
        .mob-overlay-title{font-size:1.05rem;font-weight:700;}
        .mob-overlay-sub{font-size:.78rem;color:var(--text-muted);margin-left:auto;}
        .mob-search-wrap{flex:1;display:flex;align-items:center;gap:10px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.15);border-radius:10px;padding:10px 14px;}
        .mob-search-wrap i{color:var(--text-muted);}
        .mob-search-wrap input{background:none;border:none;outline:none;color:var(--text);font-family:'DM Sans',sans-serif;font-size:.9rem;width:100%;}
        .mob-scroll{flex:1;overflow-y:auto;}
        .mob-result-item{display:flex;align-items:center;gap:12px;padding:10px 4px;border-radius:8px;cursor:pointer;transition:background .15s;border-bottom:1px solid var(--border);}
        .mob-result-item:active{background:rgba(255,255,255,0.08);}
        .mob-result-art{width:44px;height:44px;border-radius:6px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:1.5rem;}
        .mob-result-info{flex:1;min-width:0;}
        .mob-result-name{font-size:.88rem;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
        .mob-result-artist{font-size:.76rem;color:var(--text-muted);margin-top:2px;}
        .mob-result-dur{font-size:.75rem;color:var(--text-muted);flex-shrink:0;}
        .mob-empty{text-align:center;padding:40px 20px;color:var(--text-muted);display:none;}
        .mob-empty.show{display:block;}
        .mob-empty i{font-size:2rem;display:block;margin-bottom:10px;color:var(--text-faint);}
        /* pakhiii mobile add bar */
        .mob-pakhiii-add{display:flex;gap:8px;margin-bottom:12px;flex-shrink:0;position:relative;}
        .mob-pakhiii-add input{flex:1;background:rgba(255,107,157,0.08);border:1px solid rgba(255,107,157,0.25);border-radius:10px;padding:10px 14px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;}
        .mob-pakhiii-add input::placeholder{color:var(--text-faint);}
        .mob-pakhiii-add button{background:var(--pink);color:#fff;border:none;border-radius:10px;padding:10px 16px;font-size:.82rem;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;}
        .mob-suggest-drop{position:absolute;top:100%;left:0;right:0;background:#1e1e1e;border:1px solid rgba(255,107,157,0.25);border-radius:10px;z-index:50;display:none;max-height:220px;overflow-y:auto;box-shadow:0 10px 30px rgba(0,0,0,0.6);margin-top:4px;}
        .mob-suggest-drop.show{display:block;}
        .mini-player{display:none;background:#1a1a1a;border-top:1px solid var(--border);flex-direction:column;flex-shrink:0;}
        .mini-top{display:flex;align-items:center;gap:12px;padding:10px 14px 6px;cursor:pointer;}
        .mini-art{width:42px;height:42px;border-radius:6px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:1.6rem;background:var(--card-bg);}
        .mini-info{flex:1;min-width:0;}
        .mini-name{font-size:.84rem;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
        .mini-artist{font-size:.72rem;color:var(--text-muted);margin-top:2px;}
        .mini-play-btn{width:36px;height:36px;border-radius:50%;border:none;background:var(--text);color:#000;font-size:.9rem;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
        .mini-next{background:none;border:none;cursor:pointer;color:var(--text-muted);font-size:1.1rem;padding:4px;flex-shrink:0;}
        .mini-prog-wrap{padding:0 14px 10px;touch-action:none;}
        .mini-prog-outer{width:100%;height:20px;display:flex;align-items:center;cursor:pointer;touch-action:none;position:relative;}
        .mini-prog-track{width:100%;height:3px;background:var(--progress-bg);border-radius:3px;pointer-events:none;transition:height .15s;}
        .mini-prog-outer.drag .mini-prog-track{height:6px;}
        .mini-prog-fill{height:100%;background:var(--green);border-radius:3px;width:0%;pointer-events:none;}
        .nps{display:none;position:fixed;inset:0;z-index:200;flex-direction:column;overflow:hidden;}
        .nps.open{display:flex;}
        .nps-bg{position:absolute;inset:0;background:linear-gradient(180deg,#1a3a2a 0%,#0a0a0a 55%);z-index:0;transition:background .6s;}
        .nps-body{position:relative;z-index:1;flex:1;overflow-y:auto;padding:20px 24px 30px;}
        .nps-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:28px;}
        .nps-back{background:none;border:none;cursor:pointer;color:var(--text);font-size:1.1rem;padding:6px;}
        .nps-lbl{font-size:.78rem;letter-spacing:.08em;text-transform:uppercase;color:var(--text-muted);font-weight:600;}
        .nps-like-btn{background:none;border:none;cursor:pointer;color:var(--text-faint);font-size:1.3rem;padding:6px;transition:color .15s;}
        .nps-like-btn.liked{color:var(--green)!important;}
        .nps-art-wrap{display:flex;justify-content:center;margin-bottom:32px;}
        .nps-art{width:250px;height:250px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:7.5rem;box-shadow:0 20px 60px rgba(0,0,0,0.6);}
        .nps-info{margin-bottom:18px;display:flex;align-items:flex-start;justify-content:space-between;}
        .nps-name{font-size:1.5rem;font-weight:700;margin-bottom:4px;}
        .nps-artist{font-size:.9rem;color:var(--text-muted);}
        .nps-prog-wrap{margin-bottom:8px;touch-action:none;}
        .nps-prog-outer{width:100%;height:28px;display:flex;align-items:center;cursor:pointer;touch-action:none;position:relative;}
        .nps-prog-track{width:100%;height:5px;background:var(--progress-bg);border-radius:5px;pointer-events:none;transition:height .15s;}
        .nps-prog-outer.drag .nps-prog-track{height:8px;}
        .nps-prog-fill{height:100%;background:var(--green);border-radius:5px;width:0%;pointer-events:none;}
        .nps-prog-thumb{width:14px;height:14px;background:#fff;border-radius:50%;position:absolute;top:50%;transform:translate(-50%,-50%);pointer-events:none;opacity:0;transition:opacity .15s;}
        .nps-prog-outer.drag .nps-prog-thumb{opacity:1;}
        .nps-times{display:flex;justify-content:space-between;margin-bottom:20px;}
        .nps-time{font-size:.7rem;color:var(--text-muted);}
        .nps-controls{display:flex;align-items:center;justify-content:space-between;margin-bottom:28px;}
        .nps-ctrl{background:none;border:none;cursor:pointer;color:var(--text-muted);font-size:1.1rem;padding:8px;transition:color .15s;}
        .nps-ctrl.active{color:var(--green);}
        .nps-play-btn{width:58px;height:58px;border-radius:50%;border:none;background:var(--text);color:#000;font-size:1.4rem;cursor:pointer;display:flex;align-items:center;justify-content:center;}
        .nps-vol{display:flex;align-items:center;gap:12px;}
        .nps-vol-icon{color:var(--text-muted);font-size:.9rem;}
        .nps-vol-outer{flex:1;height:24px;display:flex;align-items:center;cursor:pointer;touch-action:none;position:relative;}
        .nps-vol-track{width:100%;height:4px;background:var(--progress-bg);border-radius:4px;pointer-events:none;}
        .nps-vol-fill{height:100%;background:var(--green);border-radius:4px;width:70%;pointer-events:none;}
        @media(max-width:860px){
            .sidebar{display:none;}
            .track-list-header,.track-row{grid-template-columns:34px 1fr 54px;}
            .col-album,.col-like,.track-row .t-album,.track-row .t-like{display:none;}
            .pakhiii-track-row{grid-template-columns:34px 1fr 36px 54px;}
            .hero-art{width:100px;height:100px;font-size:2.8rem;}
            .hero-title{font-size:1.9rem;}
            .player-bar{display:none;}
            .mini-player{display:flex;}
            .mobile-nav{display:flex;}
            .controls-bar .main-search{display:none;}
            .eq-panel{right:8px;bottom:130px;width:270px;}
            .sleep-panel{bottom:130px;}
        }
        @media(max-width:500px){
            .app{padding:6px;gap:6px;}
            .playlist-hero{padding:14px 14px 12px;gap:12px;}
            .hero-art{width:80px;height:80px;font-size:2.2rem;}
            .hero-title{font-size:1.5rem;}
            .controls-bar{padding:10px 14px 8px;gap:10px;}
            .track-list-header{padding:4px 14px 6px;}
            .track-row{padding:7px 14px;margin:0 4px;}
            .pakhiii-track-row{padding:7px 14px;margin:0 4px;}
            .nps-art{width:220px;height:220px;font-size:6rem;}
        }
    </style>
</head>
<body>

<!-- AUDIO ELEMENTS 1‚Äì100 -->
<audio id="audio-1"  preload="none"><source src="jeno tomari kase.mp3" type="audio/mpeg"></audio>
<audio id="audio-2"  preload="none"><source src="egiye de.mp3" type="audio/mpeg"></audio>
<audio id="audio-3"  preload="none"><source src="o mon pakhi.mp3" type="audio/mpeg"></audio>
<audio id="audio-4"  preload="none"><source src="10 e 10.mp3" type="audio/mpeg"></audio>
<audio id="audio-5"  preload="none"><source src="tauba.mp3" type="audio/mpeg"></audio>
<audio id="audio-6"  preload="none"><source src="sheesha.mp3" type="audio/mpeg"></audio>
<audio id="audio-7"  preload="none"><source src="for a reason.mp3" type="audio/mpeg"></audio>
<audio id="audio-8"  preload="none"><source src="copines.mp3" type="audio/mpeg"></audio>
<audio id="audio-9"  preload="none"><source src="bewafa.mp3" type="audio/mpeg"></audio>
<audio id="audio-10" preload="none"><source src="tumi jaio na.mp3" type="audio/mpeg"></audio>
<audio id="audio-11" preload="none"><source src="confidence.mp3" type="audio/mpeg"></audio>
<audio id="audio-12" preload="none"><source src="hotel room.mp3" type="audio/mpeg"></audio>
<audio id="audio-13" preload="none"><source src="hasta el amanecer.mp3" type="audio/mpeg"></audio>
<audio id="audio-14" preload="none"><source src="dewaana.mp3" type="audio/mpeg"></audio>
<audio id="audio-15" preload="none"><source src="haara.mp3" type="audio/mpeg"></audio>
<audio id="audio-16" preload="none"><source src="nafrat.mp3" type="audio/mpeg"></audio>
<audio id="audio-17" preload="none"><source src="inaam.mp3" type="audio/mpeg"></audio>
<audio id="audio-18" preload="none"><source src="alag aasmaan.mp3" type="audio/mpeg"></audio>
<audio id="audio-19" preload="none"><source src="meem se mohabbat.mp3" type="audio/mpeg"></audio>
<audio id="audio-20" preload="none"><source src="o je mane na.mp3" type="audio/mpeg"></audio>
<audio id="audio-21" preload="none"><source src="ishq.mp3" type="audio/mpeg"></audio>
<audio id="audio-22" preload="none"><source src="heer.mp3" type="audio/mpeg"></audio>
<audio id="audio-23" preload="none"><source src="baarish mein peyar.mp3" type="audio/mpeg"></audio>
<audio id="audio-24" preload="none"><source src="behkana.mp3" type="audio/mpeg"></audio>
<audio id="audio-25" preload="none"><source src="onno groher chand.mp3" type="audio/mpeg"></audio>
<audio id="audio-26" preload="none"><source src="baat unki.mp3" type="audio/mpeg"></audio>
<audio id="audio-27" preload="none"><source src="khat.mp3" type="audio/mpeg"></audio>
<audio id="audio-28" preload="none"><source src="tere pyar mein.mp3" type="audio/mpeg"></audio>
<audio id="audio-29" preload="none"><source src="song29.mp3" type="audio/mpeg"></audio>
<audio id="audio-30" preload="none"><source src="song30.mp3" type="audio/mpeg"></audio>
<audio id="audio-31" preload="none"><source src="song31.mp3" type="audio/mpeg"></audio>
<audio id="audio-32" preload="none"><source src="song32.mp3" type="audio/mpeg"></audio>
<audio id="audio-33" preload="none"><source src="song33.mp3" type="audio/mpeg"></audio>
<audio id="audio-34" preload="none"><source src="song34.mp3" type="audio/mpeg"></audio>
<audio id="audio-35" preload="none"><source src="song35.mp3" type="audio/mpeg"></audio>
<audio id="audio-36" preload="none"><source src="song36.mp3" type="audio/mpeg"></audio>
<audio id="audio-37" preload="none"><source src="song37.mp3" type="audio/mpeg"></audio>
<audio id="audio-38" preload="none"><source src="song38.mp3" type="audio/mpeg"></audio>
<audio id="audio-39" preload="none"><source src="song39.mp3" type="audio/mpeg"></audio>
<audio id="audio-40" preload="none"><source src="song40.mp3" type="audio/mpeg"></audio>
<audio id="audio-41" preload="none"><source src="song41.mp3" type="audio/mpeg"></audio>
<audio id="audio-42" preload="none"><source src="song42.mp3" type="audio/mpeg"></audio>
<audio id="audio-43" preload="none"><source src="song43.mp3" type="audio/mpeg"></audio>
<audio id="audio-44" preload="none"><source src="song44.mp3" type="audio/mpeg"></audio>
<audio id="audio-45" preload="none"><source src="song45.mp3" type="audio/mpeg"></audio>
<audio id="audio-46" preload="none"><source src="song46.mp3" type="audio/mpeg"></audio>
<audio id="audio-47" preload="none"><source src="song47.mp3" type="audio/mpeg"></audio>
<audio id="audio-48" preload="none"><source src="song48.mp3" type="audio/mpeg"></audio>
<audio id="audio-49" preload="none"><source src="song49.mp3" type="audio/mpeg"></audio>
<audio id="audio-50" preload="none"><source src="song50.mp3" type="audio/mpeg"></audio>
<audio id="audio-51" preload="none"><source src="song51.mp3" type="audio/mpeg"></audio>
<audio id="audio-52" preload="none"><source src="song52.mp3" type="audio/mpeg"></audio>
<audio id="audio-53" preload="none"><source src="song53.mp3" type="audio/mpeg"></audio>
<audio id="audio-54" preload="none"><source src="song54.mp3" type="audio/mpeg"></audio>
<audio id="audio-55" preload="none"><source src="song55.mp3" type="audio/mpeg"></audio>
<audio id="audio-56" preload="none"><source src="song56.mp3" type="audio/mpeg"></audio>
<audio id="audio-57" preload="none"><source src="song57.mp3" type="audio/mpeg"></audio>
<audio id="audio-58" preload="none"><source src="song58.mp3" type="audio/mpeg"></audio>
<audio id="audio-59" preload="none"><source src="song59.mp3" type="audio/mpeg"></audio>
<audio id="audio-60" preload="none"><source src="song60.mp3" type="audio/mpeg"></audio>
<audio id="audio-61" preload="none"><source src="song61.mp3" type="audio/mpeg"></audio>
<audio id="audio-62" preload="none"><source src="song62.mp3" type="audio/mpeg"></audio>
<audio id="audio-63" preload="none"><source src="song63.mp3" type="audio/mpeg"></audio>
<audio id="audio-64" preload="none"><source src="song64.mp3" type="audio/mpeg"></audio>
<audio id="audio-65" preload="none"><source src="song65.mp3" type="audio/mpeg"></audio>
<audio id="audio-66" preload="none"><source src="song66.mp3" type="audio/mpeg"></audio>
<audio id="audio-67" preload="none"><source src="song67.mp3" type="audio/mpeg"></audio>
<audio id="audio-68" preload="none"><source src="song68.mp3" type="audio/mpeg"></audio>
<audio id="audio-69" preload="none"><source src="song69.mp3" type="audio/mpeg"></audio>
<audio id="audio-70" preload="none"><source src="song70.mp3" type="audio/mpeg"></audio>
<audio id="audio-71" preload="none"><source src="song71.mp3" type="audio/mpeg"></audio>
<audio id="audio-72" preload="none"><source src="song72.mp3" type="audio/mpeg"></audio>
<audio id="audio-73" preload="none"><source src="song73.mp3" type="audio/mpeg"></audio>
<audio id="audio-74" preload="none"><source src="song74.mp3" type="audio/mpeg"></audio>
<audio id="audio-75" preload="none"><source src="song75.mp3" type="audio/mpeg"></audio>
<audio id="audio-76" preload="none"><source src="song76.mp3" type="audio/mpeg"></audio>
<audio id="audio-77" preload="none"><source src="song77.mp3" type="audio/mpeg"></audio>
<audio id="audio-78" preload="none"><source src="song78.mp3" type="audio/mpeg"></audio>
<audio id="audio-79" preload="none"><source src="song79.mp3" type="audio/mpeg"></audio>
<audio id="audio-80" preload="none"><source src="song80.mp3" type="audio/mpeg"></audio>
<audio id="audio-81" preload="none"><source src="song81.mp3" type="audio/mpeg"></audio>
<audio id="audio-82" preload="none"><source src="song82.mp3" type="audio/mpeg"></audio>
<audio id="audio-83" preload="none"><source src="song83.mp3" type="audio/mpeg"></audio>
<audio id="audio-84" preload="none"><source src="song84.mp3" type="audio/mpeg"></audio>
<audio id="audio-85" preload="none"><source src="song85.mp3" type="audio/mpeg"></audio>
<audio id="audio-86" preload="none"><source src="song86.mp3" type="audio/mpeg"></audio>
<audio id="audio-87" preload="none"><source src="song87.mp3" type="audio/mpeg"></audio>
<audio id="audio-88" preload="none"><source src="song88.mp3" type="audio/mpeg"></audio>
<audio id="audio-89" preload="none"><source src="song89.mp3" type="audio/mpeg"></audio>
<audio id="audio-90" preload="none"><source src="song90.mp3" type="audio/mpeg"></audio>
<audio id="audio-91" preload="none"><source src="song91.mp3" type="audio/mpeg"></audio>
<audio id="audio-92" preload="none"><source src="song92.mp3" type="audio/mpeg"></audio>
<audio id="audio-93" preload="none"><source src="song93.mp3" type="audio/mpeg"></audio>
<audio id="audio-94" preload="none"><source src="song94.mp3" type="audio/mpeg"></audio>
<audio id="audio-95" preload="none"><source src="song95.mp3" type="audio/mpeg"></audio>
<audio id="audio-96" preload="none"><source src="song96.mp3" type="audio/mpeg"></audio>
<audio id="audio-97" preload="none"><source src="song97.mp3" type="audio/mpeg"></audio>
<audio id="audio-98" preload="none"><source src="song98.mp3" type="audio/mpeg"></audio>
<audio id="audio-99" preload="none"><source src="song99.mp3" type="audio/mpeg"></audio>
<audio id="audio-100" preload="none"><source src="song100.mp3" type="audio/mpeg"></audio>

<script>
const COLORS=['color-1','color-2','color-3','color-4','color-5','color-6','color-7','color-8','color-9','color-10'];
const EMOJIS=['üéµ','üé∂','üé∏','üéπ','üé∫','üéª','ü•Å','üé∑','üéº','üé§'];
function mk(id,name,artist,album){return{id,name:name||`Song ${id}`,artist:artist||'Artist',album:album||'Unknown',emoji:EMOJIS[(id-1)%10],duration:'',colorClass:COLORS[(id-1)%10]};}
const TRACK_DATA=[
    mk(1,"Jeno Tomari Kase","Ash King & Somlata Acharyya Chowdhury","Jeno Tomari Kase"),
    mk(2,"Egiye De","Arijit Singh & Madhubanti Bagchi","Shudhu Tomari Jonyo"),
    mk(3,"O Mon Pakhi","Shreya Ghoshal","Mon Je Kore Uru Uru"),
    mk(4,"10 E 10","Shibu","10 E 10"),mk(5,"Tauba","Shibu","Tauba"),
    mk(6,"Sheesha","Mitta Ror, Swara Verma","Sheesha"),
    mk(7,"For A Reason","Karan Aujla & Tania & Ikky","For A Reason"),
    mk(8,"Copines","Aya Nakamura","Copines"),mk(9,"Bewafa","Imran Khan","Bewafa"),
    mk(10,"Tumi Jaio Na","Master-D & Mumzy Stranger","Tumi Jaio Na"),
    mk(11,"Confidence","Kim","Confidence"),
    mk(12,"Hotel Room","FLVCKKA, Sleezy O & Maury","Hotel Room"),
    mk(13,"Hasta El Amanecer","Nicky Jam","Hasta El Amanecer"),
    mk(14,"Dewaana","Darshan Raval, Gurpreet S & Mir D","Indie Music"),
    mk(15,"Haara","Darshan Raval, Basharat A & Mir D Nautiyal","Indie Music"),
    mk(16,"Nafrat","Darshan Raval, Darshan Raval ,Noor, Mir Desai & Naushad Khan","Indie Music"),
    mk(17,"Inaam","Anuv Jain","Inaam"),
    mk(18,"Alag Aasmaan","Anuv Jain","Alag Aasmaan"),
    mk(19,"Meem Se Mohabbat","Asim Azhar & Qirat Haider","Alag Aasmaan"),
    mk(20,"O Je Mane Na","Arnob & Sunidhi Nayak","Best of Tagore"),
    mk(21,"Ishq","Faheem Abdullah, Rauhan Malik","Ishq"),
    mk(22,"Heer","Ali Raza & Shjr","Heer"),
    mk(23,"Baarish Mein Phir","Saahel","Baarish Mein Phir"),
    mk(24,"Behkana","Ali Tariq","Behkana"),
    mk(25,"Onno Groher Chand","Sohan Ali & NabruNation","Onno Groher Chand"),
    mk(26,"Baat Unki","Kaavish","Baat Unki"),
    mk(27,"Khat","Navjot Ahuja","Khat"),
    mk(28,"Tere Pyar Mein","Kaavish","Tere Pyar Mein"),
    // add new songs here ‚Üì
];
const TRACKS=Array.from({length:100},(_,i)=>TRACK_DATA.find(t=>t.id===i+1)||mk(i+1));
</script>

<div class="app">
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo"><div class="logo-icon"><i class="fas fa-music"></i></div><span class="logo-text">My Player</span></div>
            <div class="sidebar-search"><i class="fas fa-search"></i><input type="text" id="sidebar-search" placeholder="Search songs‚Ä¶" autocomplete="off"><button class="s-clear" id="s-clear">‚úï</button></div>
            <div class="sidebar-nav">
                <div class="nav-item active" id="nav-home" onclick="showHome()"><i class="fas fa-home"></i>Home</div>
                <div class="nav-item" id="nav-liked" onclick="showLiked()"><i class="fas fa-heart"></i>Liked Songs<span class="nav-badge" id="liked-count">0</span></div>
                <div class="nav-item pakhiii-nav" id="nav-pakhiii" onclick="showPakhiii()"><i class="fas fa-star"></i>Pakhiiii's Choice<span class="nav-badge pink" id="pakhiii-count">0</span></div>
                <div class="nav-item" id="nav-queue" onclick="showQueue()"><i class="fas fa-list-ol"></i>Queue</div>
            </div>
        </div>
        <div class="sidebar-section"><span class="sidebar-section-title" id="sidebar-section-lbl">Your Playlist</span><span class="count-badge" id="count-badge"></span></div>
        <div class="sidebar-list" id="sidebar-list"></div>
        <div class="no-results" id="sidebar-no-results"><i class="fas fa-search"></i>No songs found</div>
    </div>
    <div class="main">
        <div class="playlist-hero hero-bg-home" id="main-hero">
            <div class="hero-art hero-art-home" id="hero-art">üéµ</div>
            <div class="hero-info">
                <div class="hero-type" id="hero-type">Playlist</div>
                <div class="hero-title" id="hero-title">My Playlist</div>
                <div class="hero-sub"><span id="hero-owner">You</span> &nbsp;‚Ä¢&nbsp; <span id="hero-count">100 songs</span></div>
            </div>
        </div>
        <div class="controls-bar" id="controls-bar">
            <button class="play-all-btn" id="play-all-btn"><i class="fas fa-play" id="play-all-icon"></i></button>
            <button class="icon-btn" id="shuffle-btn"><i class="fas fa-random"></i></button>
            <span class="mode-badge" id="mode-badge"></span>
            <button class="icon-btn" id="sleep-btn" title="Sleep Timer" onclick="toggleSleepPanel()" style="font-size:1.1rem;"><i class="fas fa-moon"></i></button>
            <span class="sleep-countdown" id="sleep-countdown"></span>
            <button class="icon-btn" id="eq-btn" title="Equalizer" onclick="toggleEqPanel()" style="font-size:1.1rem;"><i class="fas fa-sliders-h"></i></button>
            <div class="main-search"><i class="fas fa-search"></i><input type="text" id="main-search" placeholder="Search playlist‚Ä¶" autocomplete="off"></div>
        </div>
        <!-- Pakhiii pin banner -->
        <div class="pakhiii-pin-banner hidden-bar" id="pakhiii-pin-banner">
            <div class="pakhiii-pin-avatar">üå∏</div>
            <div class="pakhiii-pin-text">Songs chosen by <strong>Pakhiiii</strong> ‚ú® ‚Äî Add from the playlist above</div>
        </div>
        <!-- Pakhiii add bar -->
        <div class="pakhiii-add-bar hidden-bar" id="pakhiii-add-bar">
            <div class="pakhiii-add-wrap">
                <input class="pakhiii-add-inp" id="pakhiii-search-inp" type="text" placeholder="Search a song to add to Pakhiiii's Choice‚Ä¶" autocomplete="off">
                <div class="pakhiii-add-list" id="pakhiii-suggest-list"></div>
            </div>
        </div>
        <div class="track-list-header" id="track-list-header"><div style="text-align:center">#</div><div>Title</div><div class="col-album">Album</div><div class="col-like"></div><div style="text-align:right"><i class="far fa-clock"></i></div></div>
        <div class="track-list" id="track-list"></div>
        <div class="no-results" id="main-no-results" style="padding:32px 24px;display:none;"><i class="fas fa-search"></i>No songs match</div>
        <div class="track-list" id="liked-track-list" style="display:none"></div>
        <div class="liked-empty" id="liked-empty"><i class="fas fa-heart-broken"></i><h3>No liked songs yet</h3><p>Tap ‚ô° on any song to like it.</p><button class="liked-empty-btn" onclick="showHome()">Browse Songs</button></div>
        <!-- Pakhiii list -->
        <div class="pakhiii-list" id="pakhiii-list"></div>
        <div class="pakhiii-empty" id="pakhiii-empty"><div class="pakhiii-heart">üå∏</div><h3>Pakhiiii's Choice is empty</h3><p>Search and add your favourite songs using the bar above! üíï</p></div>
        <div class="queue-list" id="queue-list"></div>
        <div class="queue-empty" id="queue-empty"><i class="fas fa-list-ol"></i>Play a song to see the queue</div>
    </div>
</div>

<div class="player-bar">
    <div class="now-playing">
        <div class="now-art" id="now-art">üéµ</div>
        <div class="now-info"><div class="now-name" id="now-name">Select a song</div><div class="now-artist" id="now-artist">‚Äî</div></div>
        <button class="now-like" id="now-like-btn"><i class="far fa-heart"></i></button>
    </div>
    <div class="center-controls">
        <div class="ctrl-btns">
            <button class="ctrl-btn" id="shuffle-btn2"><i class="fas fa-random"></i></button>
            <button class="ctrl-btn" id="prev-btn"><i class="fas fa-step-backward"></i></button>
            <button class="play-pause-btn" id="play-pause-btn"><i class="fas fa-play" id="play-pause-icon"></i></button>
            <button class="ctrl-btn" id="next-btn"><i class="fas fa-step-forward"></i></button>
            <button class="ctrl-btn" id="repeat-btn"><i class="fas fa-redo"></i></button>
        </div>
        <div class="progress-row">
            <span class="time-lbl" id="time-current">0:00</span>
            <div class="prog-track" id="prog-track"><div class="prog-fill" id="prog-fill"></div><div class="prog-thumb" id="prog-thumb"></div></div>
            <span class="time-lbl right" id="time-total">‚Äî</span>
        </div>
    </div>
    <div class="right-controls">
        <div class="vol-row">
            <button class="vol-btn" id="mute-btn"><i class="fas fa-volume-up" id="vol-icon"></i></button>
            <div class="vol-track" id="vol-track"><div class="vol-fill" id="vol-fill"></div></div>
        </div>
    </div>
</div>

<div class="mini-player" id="mini-player">
    <div class="mini-top" onclick="openNPS()">
        <div class="mini-art" id="mini-art">üéµ</div>
        <div class="mini-info"><div class="mini-name" id="mini-name">Select a song</div><div class="mini-artist" id="mini-artist">‚Äî</div></div>
        <button class="mini-play-btn" onclick="event.stopPropagation();document.getElementById('play-pause-btn').click()"><i class="fas fa-play" id="mini-play-icon"></i></button>
        <button class="mini-next" onclick="event.stopPropagation();playNext()"><i class="fas fa-step-forward"></i></button>
    </div>
    <div class="mini-prog-wrap">
        <div class="mini-prog-outer" id="mini-prog-outer">
            <div class="mini-prog-track"><div class="mini-prog-fill" id="mini-prog-fill"></div></div>
        </div>
    </div>
</div>

<div class="mobile-nav">
    <button class="mob-nav-btn active" id="mob-home-btn" onclick="showHome();closeAllMob()"><i class="fas fa-home"></i><span>Home</span></button>
    <button class="mob-nav-btn" onclick="openMobSearch()"><i class="fas fa-search"></i><span>Search</span></button>
    <button class="mob-nav-btn" id="mob-shuffle-btn" onclick="toggleShuffle()"><i class="fas fa-random"></i><span>Shuffle</span></button>
    <button class="mob-nav-btn" onclick="openMobLiked()"><i class="fas fa-heart"></i><span>Liked</span><span class="mob-dot" id="mob-liked-dot"></span></button>
    <button class="mob-nav-btn pakhiii-mob" onclick="openMobPakhiii()"><i class="fas fa-star"></i><span>Pakhiiii</span><span class="mob-dot pink" id="mob-pakhiii-dot"></span></button>
</div>

<div class="mob-overlay" id="mob-search-ov">
    <div class="mob-overlay-header"><button class="mob-back" onclick="closeMobSearch()"><i class="fas fa-arrow-left"></i></button><div class="mob-search-wrap"><i class="fas fa-search"></i><input type="text" id="mob-search-input" placeholder="Search songs‚Ä¶" autocomplete="off"></div></div>
    <div class="mob-scroll" id="mob-search-results"></div>
    <div class="mob-empty" id="mob-search-empty"><i class="fas fa-search"></i>No results</div>
</div>

<div class="mob-overlay" id="mob-liked-ov">
    <div class="mob-overlay-header"><button class="mob-back" onclick="closeMobLiked()"><i class="fas fa-arrow-left"></i></button><span class="mob-overlay-title">‚ù§Ô∏è Liked Songs</span><span class="mob-overlay-sub" id="mob-liked-sub">0 songs</span></div>
    <div class="mob-scroll" id="mob-liked-list"></div>
    <div class="mob-empty" id="mob-liked-empty"><i class="fas fa-heart-broken"></i>No liked songs yet</div>
</div>

<!-- Mobile Pakhiii overlay -->
<div class="mob-overlay" id="mob-pakhiii-ov">
    <div class="mob-overlay-header"><button class="mob-back" onclick="closeMobPakhiii()"><i class="fas fa-arrow-left"></i></button><span class="mob-overlay-title">üå∏ Pakhiiii's Choice</span><span class="mob-overlay-sub" id="mob-pakhiii-sub">0 songs</span></div>
    <div class="mob-pakhiii-add" style="position:relative">
        <input type="text" id="mob-pakhiii-inp" placeholder="Search & add a song‚Ä¶" autocomplete="off">
        <button onclick="mobPakhiiiAdd()">Add</button>
        <div class="mob-suggest-drop" id="mob-pakhiii-drop"></div>
    </div>
    <div class="mob-scroll" id="mob-pakhiii-list"></div>
    <div class="mob-empty" id="mob-pakhiii-empty"><span style="font-size:2rem;display:block;margin-bottom:10px">üå∏</span>No songs added yet</div>
</div>

<div class="mob-overlay" id="mob-queue-ov">
    <div class="mob-overlay-header"><button class="mob-back" onclick="closeMobQueue()"><i class="fas fa-arrow-left"></i></button><span class="mob-overlay-title">üéµ Queue</span><span class="mob-overlay-sub" id="mob-queue-sub"></span></div>
    <div class="mob-scroll" id="mob-queue-list"></div>
    <div class="mob-empty" id="mob-queue-empty"><i class="fas fa-list-ol"></i>Play a song to see queue</div>
</div>

<div class="nps" id="nps">
    <div class="nps-bg" id="nps-bg"></div>
    <div class="nps-body">
        <div class="nps-header">
            <button class="nps-back" onclick="closeNPS()"><i class="fas fa-chevron-down"></i></button>
            <span class="nps-lbl">Now Playing</span>
            <button class="nps-like-btn" id="nps-like-btn" onclick="nowLike()"><i class="far fa-heart"></i></button>
        </div>
        <div class="nps-art-wrap"><div class="nps-art" id="nps-art">üéµ</div></div>
        <div class="nps-info"><div><div class="nps-name" id="nps-name">Select a song</div><div class="nps-artist" id="nps-artist">‚Äî</div></div></div>
        <div class="nps-prog-wrap">
            <div class="nps-prog-outer" id="nps-prog-outer">
                <div class="nps-prog-track"><div class="nps-prog-fill" id="nps-prog-fill"></div></div>
                <div class="nps-prog-thumb" id="nps-prog-thumb"></div>
            </div>
        </div>
        <div class="nps-times"><span class="nps-time" id="nps-current">0:00</span><span class="nps-time" id="nps-total">‚Äî</span></div>
        <div class="nps-controls">
            <button class="nps-ctrl" id="nps-shuffle-btn" onclick="toggleShuffle()"><i class="fas fa-random"></i></button>
            <button class="nps-ctrl" onclick="playPrev()"><i class="fas fa-step-backward" style="font-size:1.3rem"></i></button>
            <button class="nps-play-btn" onclick="document.getElementById('play-pause-btn').click()"><i class="fas fa-play" id="nps-play-icon"></i></button>
            <button class="nps-ctrl" onclick="playNext()"><i class="fas fa-step-forward" style="font-size:1.3rem"></i></button>
            <button class="nps-ctrl" id="nps-repeat-btn" onclick="toggleRepeat()"><i class="fas fa-redo"></i></button>
        </div>
        <div class="nps-vol">
            <i class="nps-vol-icon fas fa-volume-down"></i>
            <div class="nps-vol-outer" id="nps-vol-outer"><div class="nps-vol-track"><div class="nps-vol-fill" id="nps-vol-fill"></div></div></div>
            <i class="nps-vol-icon fas fa-volume-up"></i>
        </div>
    </div>
</div>

<div class="eq-panel" id="eq-panel">
    <div class="panel-header"><span class="panel-title">üéöÔ∏è Equalizer</span><button class="panel-close" onclick="toggleEqPanel()"><i class="fas fa-times"></i></button></div>
    <div class="eq-presets">
        <button class="eq-preset active" onclick="applyPreset('flat',this)">Flat</button>
        <button class="eq-preset" onclick="applyPreset('bass',this)">Bass Boost</button>
        <button class="eq-preset" onclick="applyPreset('treble',this)">Treble</button>
        <button class="eq-preset" onclick="applyPreset('vocal',this)">Vocal</button>
        <button class="eq-preset" onclick="applyPreset('pop',this)">Pop</button>
        <button class="eq-preset" onclick="applyPreset('rock',this)">Rock</button>
    </div>
    <div class="eq-bands" id="eq-bands"></div>
</div>

<div class="sleep-panel" id="sleep-panel">
    <div class="panel-header"><span class="panel-title">‚è∞ Sleep Timer</span><button class="panel-close" onclick="toggleSleepPanel()"><i class="fas fa-times"></i></button></div>
    <div class="sleep-options">
        <button class="sleep-opt" onclick="setSleep(5,this)">5 min</button>
        <button class="sleep-opt" onclick="setSleep(10,this)">10 min</button>
        <button class="sleep-opt" onclick="setSleep(15,this)">15 min</button>
        <button class="sleep-opt" onclick="setSleep(30,this)">30 min</button>
        <button class="sleep-opt" onclick="setSleep(45,this)">45 min</button>
        <button class="sleep-opt" onclick="setSleep(60,this)">60 min</button>
    </div>
    <button class="sleep-cancel" onclick="cancelSleep()">Cancel Timer</button>
</div>

<script>
/* ‚ïê‚ïê STATE ‚ïê‚ïê */
let currentIdx=-1,isPlaying=false,isShuffle=false,isRepeat=false;
// ‚úÖ FIX: Load liked songs from localStorage so they persist after refresh
let likedTracks=new Set(JSON.parse(localStorage.getItem('likedTracks')||'[]'));
// ‚úÖ NEW: Load Pakhiiii's choice from localStorage
let pakhiiiTracks=JSON.parse(localStorage.getItem('pakhiiiTracks')||'[]'); // array of track indices
let currentView='home';
let volume=0.7,isMuted=false,prevVolume=0.7,isDragging=false;
let shuffleQ=[],shufflePos=-1;
let sleepTimer=null,sleepRemaining=0,sleepInterval=null;

const audios=TRACKS.map(t=>document.getElementById(`audio-${t.id}`));
function setVolAll(v){audios.forEach(a=>{if(a)a.volume=v;});}
setVolAll(volume);

/* ‚ïê‚ïê PERSIST ‚ïê‚ïê */
function saveLikes(){localStorage.setItem('likedTracks',JSON.stringify([...likedTracks]));}
function savePakhiii(){localStorage.setItem('pakhiiiTracks',JSON.stringify(pakhiiiTracks));}

/* ‚ïê‚ïê WEB AUDIO EQ ‚ïê‚ïê */
let audioCtx=null,eqNodes=[],srcMap=new Map();
const EQ_FREQS=[60,250,1000,4000,12000];
const EQ_LABELS=['60Hz','250Hz','1kHz','4kHz','12kHz'];
const EQ_PRESETS={flat:[0,0,0,0,0],bass:[8,5,0,-2,-3],treble:[-3,-2,0,4,7],vocal:[-2,2,5,3,-1],pop:[2,1,0,2,1],rock:[4,2,-1,2,4]};

function initAudioCtx(){
    if(audioCtx)return;
    audioCtx=new(window.AudioContext||window.webkitAudioContext)();
    eqNodes=EQ_FREQS.map((freq,i)=>{
        const f=audioCtx.createBiquadFilter();
        f.type=i===0?'lowshelf':i===EQ_FREQS.length-1?'highshelf':'peaking';
        f.frequency.value=freq;f.Q.value=1;f.gain.value=0;return f;
    });
    for(let i=0;i<eqNodes.length-1;i++)eqNodes[i].connect(eqNodes[i+1]);
    eqNodes[eqNodes.length-1].connect(audioCtx.destination);
}
function hookAudio(audio){
    if(srcMap.has(audio))return;
    initAudioCtx();
    const src=audioCtx.createMediaElementSource(audio);
    src.connect(eqNodes[0]);srcMap.set(audio,src);
}
function buildEqUI(){
    document.getElementById('eq-bands').innerHTML=EQ_FREQS.map((_,i)=>`
        <div class="eq-band">
            <div class="eq-val" id="eqv-${i}">0dB</div>
            <div class="eq-slider-wrap"><input type="range" class="eq-sl" id="eqs-${i}" min="-12" max="12" value="0" step="1" oninput="setEqBand(${i},this.value)"></div>
            <label>${EQ_LABELS[i]}</label>
        </div>`).join('');
}
function setEqBand(i,v){
    v=parseFloat(v);
    document.getElementById(`eqv-${i}`).textContent=(v>0?'+':'')+v+'dB';
    if(eqNodes[i])eqNodes[i].gain.value=v;
    document.querySelectorAll('.eq-preset').forEach(p=>p.classList.remove('active'));
}
function applyPreset(name,btn){
    const vals=EQ_PRESETS[name]||[0,0,0,0,0];
    vals.forEach((v,i)=>{
        document.getElementById(`eqs-${i}`).value=v;
        document.getElementById(`eqv-${i}`).textContent=(v>0?'+':'')+v+'dB';
        if(eqNodes[i])eqNodes[i].gain.value=v;
    });
    document.querySelectorAll('.eq-preset').forEach(p=>p.classList.remove('active'));
    btn.classList.add('active');
}
function toggleEqPanel(){initAudioCtx();document.getElementById('eq-panel').classList.toggle('open');document.getElementById('sleep-panel').classList.remove('open');}
function toggleSleepPanel(){document.getElementById('sleep-panel').classList.toggle('open');document.getElementById('eq-panel').classList.remove('open');}

/* ‚ïê‚ïê SLEEP TIMER ‚ïê‚ïê */
function setSleep(mins,btn){
    cancelSleep();sleepRemaining=mins*60;
    document.querySelectorAll('.sleep-opt').forEach(b=>b.classList.remove('active'));btn.classList.add('active');
    document.getElementById('sleep-countdown').classList.add('show');
    updateSleepDisplay();
    sleepInterval=setInterval(()=>{
        sleepRemaining--;updateSleepDisplay();
        if(sleepRemaining<=0){cancelSleep();if(currentIdx>=0){audios[currentIdx].pause();isPlaying=false;updatePlayBtns(false);}}
    },1000);
}
function updateSleepDisplay(){
    const m=Math.floor(sleepRemaining/60),s=sleepRemaining%60;
    document.getElementById('sleep-countdown').textContent=`‚è∞ ${m}:${String(s).padStart(2,'0')}`;
    document.getElementById('sleep-btn').style.color=sleepRemaining>0?'#ff9632':'';
}
function cancelSleep(){
    clearInterval(sleepInterval);sleepInterval=null;sleepRemaining=0;
    document.getElementById('sleep-countdown').classList.remove('show');
    document.getElementById('sleep-btn').style.color='';
    document.querySelectorAll('.sleep-opt').forEach(b=>b.classList.remove('active'));
}

/* ‚ïê‚ïê SHUFFLE ‚ïê‚ïê */
function genShuffleQ(start){
    const pool=TRACKS.map((_,i)=>i).filter(i=>i!==start);
    for(let i=pool.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[pool[i],pool[j]]=[pool[j],pool[i]];}
    shuffleQ=start>=0?[start,...pool]:pool;shufflePos=0;
}
function nextShuffleIdx(){shufflePos++;if(shufflePos>=shuffleQ.length){genShuffleQ(shuffleQ[shuffleQ.length-1]);shufflePos=1;}return shuffleQ[shufflePos];}
function prevShuffleIdx(){shufflePos=Math.max(0,shufflePos-1);return shuffleQ[shufflePos];}

/* ‚ïê‚ïê DURATION LOADING ‚ïê‚ïê */
function preloadDurations(){
    const BATCH=10;let i=0;
    function loadBatch(){
        const end=Math.min(i+BATCH,TRACKS.length);
        for(;i<end;i++){
            const audio=audios[i],idx=i;
            if(!audio)continue;
            if(audio.readyState>=1&&audio.duration&&!isNaN(audio.duration)){setDur(idx,audio.duration);continue;}
            audio.preload='metadata';
            audio.addEventListener('loadedmetadata',function cb(){
                if(audio.duration&&!isNaN(audio.duration))setDur(idx,audio.duration);
                audio.removeEventListener('loadedmetadata',cb);
            });
            audio.load();
        }
        if(i<TRACKS.length)setTimeout(loadBatch,300);
    }
    loadBatch();
}
function setDur(i,sec){
    TRACKS[i].duration=fmt(sec);
    const td=document.getElementById(`tdur-${i}`);
    const sd=document.getElementById(`sdur-${i}`);
    if(td)td.textContent=TRACKS[i].duration;
    if(sd)sd.textContent=TRACKS[i].duration;
    document.querySelectorAll(`[data-dur="${i}"]`).forEach(el=>el.textContent=TRACKS[i].duration);
}

/* ‚ïê‚ïê BUILD UI ‚ïê‚ïê */
function isEmpty(t){return t.name===`Song ${t.id}`;}
function buildSidebar(){
    document.getElementById('sidebar-list').innerHTML=TRACKS.map((t,i)=>`
        <div class="sidebar-track" id="sidebar-${i}" onclick="playSong(${i})">
            <div class="s-num"><span class="s-num-val">${i+1}</span><div class="playing-bars"><span></span><span></span><span></span></div></div>
            <div class="s-art ${t.colorClass}">${t.emoji}</div>
            <div class="s-info">
                <div class="s-name">${t.name}${isEmpty(t)?'<span class="empty-badge">empty</span>':''}</div>
                <div class="s-artist">${t.artist}</div>
            </div>
            <div class="s-dur" id="sdur-${i}">‚Äî</div>
        </div>`).join('');
}
function buildHomeList(){
    document.getElementById('track-list').innerHTML=TRACKS.map((t,i)=>`
        <div class="track-row" id="track-row-${i}" onclick="playSong(${i})">
            <div class="t-idx"><span class="t-idx-num">${i+1}</span><i class="fas fa-play t-play-ico"></i></div>
            <div class="t-main">
                <div class="t-art ${t.colorClass}">${t.emoji}</div>
                <div style="min-width:0">
                    <div class="t-name">${t.name}${isEmpty(t)?'<span class="empty-badge">empty</span>':''}</div>
                    <div class="t-artist">${t.artist}</div>
                </div>
            </div>
            <div class="t-album">${t.album}</div>
            <button class="t-like" id="like-${i}" onclick="toggleLike(event,${i})"><i class="far fa-heart"></i></button>
            <div class="t-dur" id="tdur-${i}">‚Äî</div>
        </div>`).join('');
}
function buildLikedList(){
    const arr=[...likedTracks],el=document.getElementById('liked-track-list'),empty=document.getElementById('liked-empty');
    if(!arr.length){el.innerHTML='';empty.classList.add('show');return;}
    empty.classList.remove('show');
    el.innerHTML=arr.map((idx,pos)=>{const t=TRACKS[idx];return`
        <div class="track-row ${currentIdx===idx?'active':''}" id="liked-row-${idx}" onclick="playSong(${idx})">
            <div class="t-idx"><span class="t-idx-num">${pos+1}</span><i class="fas fa-play t-play-ico"></i></div>
            <div class="t-main"><div class="t-art ${t.colorClass}">${t.emoji}</div><div style="min-width:0"><div class="t-name">${t.name}</div><div class="t-artist">${t.artist}</div></div></div>
            <div class="t-album">${t.album}</div>
            <button class="t-like liked" onclick="toggleLike(event,${idx})"><i class="fas fa-heart"></i></button>
            <div class="t-dur" data-dur="${idx}">${t.duration||'‚Äî'}</div>
        </div>`;}).join('');
}

/* ‚ïê‚ïê PAKHIII LIST ‚ïê‚ïê */
function buildPakhiiiList(){
    const el=document.getElementById('pakhiii-list'),empty=document.getElementById('pakhiii-empty');
    if(!pakhiiiTracks.length){el.innerHTML='';empty.classList.add('show');return;}
    empty.classList.remove('show');
    el.innerHTML=pakhiiiTracks.map((idx,pos)=>{const t=TRACKS[idx];return`
        <div class="pakhiii-track-row ${currentIdx===idx?'active':''}" id="pakhiii-row-${idx}" onclick="playSong(${idx})">
            <div class="t-idx"><span class="t-idx-num">${pos+1}</span><i class="fas fa-play t-play-ico"></i></div>
            <div class="t-main"><div class="t-art ${t.colorClass}">${t.emoji}</div><div style="min-width:0"><div class="t-name">${t.name}<span class="pakhiii-heart-badge">üå∏ pakhiiii</span></div><div class="t-artist">${t.artist}</div></div></div>
            <button class="t-remove" onclick="removePakhiii(event,${idx})" title="Remove"><i class="fas fa-times"></i></button>
            <div class="t-dur" data-dur="${idx}">${t.duration||'‚Äî'}</div>
        </div>`;}).join('');
}
function addToPakhiii(idx){
    if(pakhiiiTracks.includes(idx))return;
    pakhiiiTracks.push(idx);savePakhiii();updatePakhiiiBadges();
    if(currentView==='pakhiii'){buildPakhiiiList();document.getElementById('hero-count').textContent=`${pakhiiiTracks.length} songs`;}
}
function removePakhiii(e,idx){
    e.stopPropagation();
    pakhiiiTracks=pakhiiiTracks.filter(i=>i!==idx);
    savePakhiii();updatePakhiiiBadges();
    if(currentView==='pakhiii'){buildPakhiiiList();document.getElementById('hero-count').textContent=`${pakhiiiTracks.length} songs`;}
}
function updatePakhiiiBadges(){
    const n=pakhiiiTracks.length;
    const pc=document.getElementById('pakhiii-count');pc.textContent=n;pc.classList.toggle('show',n>0);
    document.getElementById('mob-pakhiii-dot').classList.toggle('show',n>0);
    document.getElementById('mob-pakhiii-sub').textContent=`${n} songs`;
}

/* ‚ïê‚ïê PAKHIII SEARCH SUGGEST (desktop) ‚ïê‚ïê */
document.getElementById('pakhiii-search-inp').addEventListener('input',function(){
    const q=this.value.toLowerCase().trim();
    const drop=document.getElementById('pakhiii-suggest-list');
    if(!q){drop.classList.remove('show');return;}
    const matches=TRACKS.filter(t=>!isEmpty(t)&&(t.name.toLowerCase().includes(q)||t.artist.toLowerCase().includes(q))).slice(0,8);
    if(!matches.length){drop.classList.remove('show');return;}
    drop.innerHTML=matches.map(t=>{const i=TRACKS.indexOf(t);return`
        <div class="pakhiii-suggest-item" onclick="addToPakhiii(${i});document.getElementById('pakhiii-search-inp').value='';document.getElementById('pakhiii-suggest-list').classList.remove('show');">
            <div class="pakhiii-suggest-art ${t.colorClass}">${t.emoji}</div>
            <div><div class="pakhiii-suggest-name">${t.name}</div><div class="pakhiii-suggest-artist">${t.artist}</div></div>
        </div>`;}).join('');
    drop.classList.add('show');
});
document.addEventListener('click',e=>{
    if(!e.target.closest('#pakhiii-add-bar'))document.getElementById('pakhiii-suggest-list').classList.remove('show');
});

/* ‚ïê‚ïê PAKHIII MOBILE ‚ïê‚ïê */
document.getElementById('mob-pakhiii-inp').addEventListener('input',function(){
    const q=this.value.toLowerCase().trim();
    const drop=document.getElementById('mob-pakhiii-drop');
    if(!q){drop.classList.remove('show');return;}
    const matches=TRACKS.filter(t=>!isEmpty(t)&&(t.name.toLowerCase().includes(q)||t.artist.toLowerCase().includes(q))).slice(0,6);
    if(!matches.length){drop.classList.remove('show');return;}
    drop.innerHTML=matches.map(t=>{const i=TRACKS.indexOf(t);return`
        <div class="pakhiii-suggest-item" onclick="addToPakhiii(${i});document.getElementById('mob-pakhiii-inp').value='';document.getElementById('mob-pakhiii-drop').classList.remove('show');renderMobPakhiii();">
            <div class="pakhiii-suggest-art ${t.colorClass}">${t.emoji}</div>
            <div><div class="pakhiii-suggest-name">${t.name}</div><div class="pakhiii-suggest-artist">${t.artist}</div></div>
        </div>`;}).join('');
    drop.classList.add('show');
});
function mobPakhiiiAdd(){
    const inp=document.getElementById('mob-pakhiii-inp');
    const q=inp.value.toLowerCase().trim();if(!q)return;
    const t=TRACKS.find(t=>!isEmpty(t)&&(t.name.toLowerCase().includes(q)||t.artist.toLowerCase().includes(q)));
    if(t){addToPakhiii(TRACKS.indexOf(t));inp.value='';document.getElementById('mob-pakhiii-drop').classList.remove('show');renderMobPakhiii();}
}

function buildQueueList(){
    const qEl=document.getElementById('queue-list'),qEm=document.getElementById('queue-empty');
    if(currentIdx<0){qEl.innerHTML='';qEm.classList.add('show');return;}
    qEm.classList.remove('show');
    const items=[];
    if(isShuffle){for(let i=shufflePos;i<Math.min(shufflePos+25,shuffleQ.length);i++)items.push({idx:shuffleQ[i],pos:i-shufflePos});}
    else{for(let i=currentIdx;i<Math.min(currentIdx+25,TRACKS.length);i++)items.push({idx:i,pos:i-currentIdx});}
    qEl.innerHTML=items.map(({idx,pos})=>{const t=TRACKS[idx];return`
        <div class="queue-item ${pos===0?'now':''}" onclick="playSong(${idx})">
            <div class="qi-pos">${pos===0?'‚ñ∂':'+'+pos}</div>
            <div class="qi-art ${t.colorClass}">${t.emoji}</div>
            <div class="qi-info"><div class="qi-name">${t.name}</div><div class="qi-artist">${t.artist}</div></div>
            <div class="qi-dur" data-dur="${idx}">${t.duration||'‚Äî'}</div>
        </div>`;}).join('');
}

/* ‚ïê‚ïê VIEW SWITCHING ‚ïê‚ïê */
function showHome(){
    currentView='home';
    ['nav-liked','nav-queue','nav-pakhiii'].forEach(id=>document.getElementById(id).classList.remove('active'));
    document.getElementById('nav-home').classList.add('active');
    document.getElementById('mob-home-btn').classList.add('active');
    setHero('playlist-hero hero-bg-home','hero-art hero-art-home','üéµ','Playlist','My Playlist','You',`${TRACKS.length} songs`,false);
    document.getElementById('sidebar-section-lbl').textContent='Your Playlist';
    document.getElementById('track-list').style.display='';
    document.getElementById('main-no-results').style.display='none';
    document.getElementById('liked-track-list').style.display='none';
    document.getElementById('liked-empty').classList.remove('show');
    document.getElementById('pakhiii-list').style.display='none';
    document.getElementById('pakhiii-empty').classList.remove('show');
    document.getElementById('queue-list').style.display='none';
    document.getElementById('queue-empty').classList.remove('show');
    document.getElementById('track-list-header').style.display='';
    document.getElementById('pakhiii-add-bar').classList.add('hidden-bar');
    document.getElementById('pakhiii-pin-banner').classList.add('hidden-bar');
    document.getElementById('play-all-btn').classList.remove('pakhiii-play');
    TRACKS.forEach((_,i)=>document.getElementById(`sidebar-${i}`)?.classList.remove('hidden'));
    runSearch(document.getElementById('main-search').value);
}
function showLiked(){
    currentView='liked';
    ['nav-home','nav-queue','nav-pakhiii'].forEach(id=>document.getElementById(id).classList.remove('active'));
    document.getElementById('nav-liked').classList.add('active');
    setHero('playlist-hero hero-bg-liked','hero-art hero-art-liked','‚ù§Ô∏è','Collection','Liked Songs','You',`${likedTracks.size} songs`,false);
    document.getElementById('sidebar-section-lbl').textContent='Liked Songs';
    document.getElementById('main-search').value='';
    document.getElementById('track-list').style.display='none';
    document.getElementById('main-no-results').style.display='none';
    document.getElementById('liked-track-list').style.display='';
    document.getElementById('pakhiii-list').style.display='none';
    document.getElementById('pakhiii-empty').classList.remove('show');
    document.getElementById('queue-list').style.display='none';
    document.getElementById('queue-empty').classList.remove('show');
    document.getElementById('track-list-header').style.display='';
    document.getElementById('pakhiii-add-bar').classList.add('hidden-bar');
    document.getElementById('pakhiii-pin-banner').classList.add('hidden-bar');
    document.getElementById('play-all-btn').classList.remove('pakhiii-play');
    buildLikedList();
    TRACKS.forEach((_,i)=>document.getElementById(`sidebar-${i}`)?.classList.toggle('hidden',!likedTracks.has(i)));
    document.getElementById('sidebar-no-results').classList.toggle('show',likedTracks.size===0);
}
function showPakhiii(){
    currentView='pakhiii';
    ['nav-home','nav-liked','nav-queue'].forEach(id=>document.getElementById(id).classList.remove('active'));
    document.getElementById('nav-pakhiii').classList.add('active');
    setHero('playlist-hero hero-bg-pakhiii pakhiii-hero','hero-art hero-art-pakhiii','üå∏','Special Collection','Pakhiiii\'s Choice','Pakhiiii üíï',`${pakhiiiTracks.length} songs`,true);
    document.getElementById('sidebar-section-lbl').textContent="Pakhiiii's Choice";
    document.getElementById('main-search').value='';
    document.getElementById('track-list').style.display='none';
    document.getElementById('main-no-results').style.display='none';
    document.getElementById('liked-track-list').style.display='none';
    document.getElementById('liked-empty').classList.remove('show');
    document.getElementById('pakhiii-list').style.display='';
    document.getElementById('queue-list').style.display='none';
    document.getElementById('queue-empty').classList.remove('show');
    document.getElementById('track-list-header').style.display='none';
    document.getElementById('pakhiii-add-bar').classList.remove('hidden-bar');
    document.getElementById('pakhiii-pin-banner').classList.remove('hidden-bar');
    document.getElementById('play-all-btn').classList.add('pakhiii-play');
    buildPakhiiiList();
    TRACKS.forEach((_,i)=>document.getElementById(`sidebar-${i}`)?.classList.toggle('hidden',!pakhiiiTracks.includes(i)));
    document.getElementById('sidebar-no-results').classList.toggle('show',pakhiiiTracks.length===0);
}
function showQueue(){
    currentView='queue';
    ['nav-home','nav-liked','nav-pakhiii'].forEach(id=>document.getElementById(id).classList.remove('active'));
    document.getElementById('nav-queue').classList.add('active');
    setHero('playlist-hero hero-bg-queue','hero-art hero-art-queue','üéµ','Up Next','Queue','','',false);
    document.getElementById('track-list').style.display='none';
    document.getElementById('main-no-results').style.display='none';
    document.getElementById('liked-track-list').style.display='none';
    document.getElementById('liked-empty').classList.remove('show');
    document.getElementById('pakhiii-list').style.display='none';
    document.getElementById('pakhiii-empty').classList.remove('show');
    document.getElementById('queue-list').style.display='';
    document.getElementById('track-list-header').style.display='none';
    document.getElementById('pakhiii-add-bar').classList.add('hidden-bar');
    document.getElementById('pakhiii-pin-banner').classList.add('hidden-bar');
    document.getElementById('play-all-btn').classList.remove('pakhiii-play');
    buildQueueList();
}
function setHero(heroClass,artClass,emoji,type,title,owner,count,isPakhiii){
    document.getElementById('main-hero').className=heroClass;
    const art=document.getElementById('hero-art');art.className=artClass;art.textContent=emoji;
    document.getElementById('hero-type').textContent=type;
    const titleEl=document.getElementById('hero-title');titleEl.textContent=title;
    titleEl.className=isPakhiii?'hero-title pakhiii-title':'hero-title';
    document.getElementById('hero-owner').textContent=owner;
    document.getElementById('hero-count').textContent=count;
}

/* ‚ïê‚ïê PLAY ‚ïê‚ïê */
const BG_COLORS={'color-1':'#1a3a6a','color-2':'#6a1a3a','color-3':'#6a3a1a','color-4':'#1a6a3a','color-5':'#3a1a6a','color-6':'#5a5a1a','color-7':'#1a5a6a','color-8':'#6a1a6a','color-9':'#2a6a1a','color-10':'#6a2a1a'};
function playSong(idx){
    if(currentIdx>=0&&currentIdx!==idx){audios[currentIdx]?.pause();if(audios[currentIdx])audios[currentIdx].currentTime=0;setActive(currentIdx,false);}
    currentIdx=idx;
    if(isShuffle)genShuffleQ(idx);
    const audio=audios[idx],t=TRACKS[idx];
    if(!audio)return;
    audio.preload='auto';
    if(audioCtx)hookAudio(audio);
    audio.volume=isMuted?0:volume;
    audio.play().catch(()=>{});
    isPlaying=true;setActive(idx,true);updateNP(t);updatePlayBtns(true);
    if(currentView==='queue')buildQueueList();
    const nextIdx=(idx+1)%TRACKS.length;
    if(audios[nextIdx]&&audios[nextIdx].preload==='none'){audios[nextIdx].preload='metadata';audios[nextIdx].load();}
}
function setActive(idx,on){
    document.getElementById(`sidebar-${idx}`)?.classList.toggle('active',on);
    document.getElementById(`track-row-${idx}`)?.classList.toggle('active',on);
    document.getElementById(`liked-row-${idx}`)?.classList.toggle('active',on);
    document.getElementById(`pakhiii-row-${idx}`)?.classList.toggle('active',on);
    if(!on)document.getElementById(`sidebar-${idx}`)?.classList.remove('paused-state');
}
function updateNP(t){
    const col=BG_COLORS[t.colorClass]||'#1a3a2a';
    document.getElementById('nps-bg').style.background=`linear-gradient(180deg,${col} 0%,#0a0a0a 55%)`;
    [['now-art',`now-art ${t.colorClass}`],['mini-art',`mini-art ${t.colorClass}`],['nps-art',`nps-art ${t.colorClass}`]].forEach(([id,cls])=>{const el=document.getElementById(id);if(el){el.textContent=t.emoji;el.className=cls;}});
    setText('now-name',t.name);setText('now-artist',t.artist);
    setText('mini-name',t.name);setText('mini-artist',t.artist);
    setText('nps-name',t.name);setText('nps-artist',t.artist);
    refreshLikes();
}
function updatePlayBtns(p){isPlaying=p;const cls=p?'fas fa-pause':'fas fa-play';['play-pause-icon','play-all-icon','mini-play-icon','nps-play-icon'].forEach(id=>{const el=document.getElementById(id);if(el)el.className=cls;});}
function setText(id,txt){const el=document.getElementById(id);if(el)el.textContent=txt;}

/* ‚ïê‚ïê CONTROLS ‚ïê‚ïê */
document.getElementById('play-pause-btn').addEventListener('click',()=>{
    if(currentIdx<0){playSong(0);return;}
    const audio=audios[currentIdx];
    if(isPlaying){audio.pause();isPlaying=false;updatePlayBtns(false);document.getElementById(`sidebar-${currentIdx}`)?.classList.add('paused-state');}
    else{audio.play().catch(()=>{});isPlaying=true;updatePlayBtns(true);document.getElementById(`sidebar-${currentIdx}`)?.classList.remove('paused-state');}
});
document.getElementById('play-all-btn').addEventListener('click',()=>{
    if(currentView==='pakhiii'&&pakhiiiTracks.length>0&&currentIdx<0){playSong(pakhiiiTracks[0]);return;}
    if(currentIdx<0){playSong(0);return;}
    document.getElementById('play-pause-btn').click();
});
document.getElementById('next-btn').addEventListener('click',playNext);
document.getElementById('prev-btn').addEventListener('click',playPrev);
function playNext(){if(!TRACKS.length)return;playSong(isShuffle?nextShuffleIdx():(currentIdx+1)%TRACKS.length);}
function playPrev(){if(currentIdx<0)return;if(audios[currentIdx]?.currentTime>3){audios[currentIdx].currentTime=0;return;}playSong(isShuffle?prevShuffleIdx():(currentIdx-1+TRACKS.length)%TRACKS.length);}
function toggleShuffle(){
    isShuffle=!isShuffle;if(isShuffle)genShuffleQ(currentIdx>=0?currentIdx:0);
    ['shuffle-btn','shuffle-btn2','nps-shuffle-btn','mob-shuffle-btn'].forEach(id=>document.getElementById(id)?.classList.toggle('active',isShuffle));
    const b=document.getElementById('mode-badge');b.textContent=isShuffle?'üîÄ Shuffle ON':'';b.classList.toggle('show',isShuffle);
}
document.getElementById('shuffle-btn').addEventListener('click',toggleShuffle);
document.getElementById('shuffle-btn2').addEventListener('click',toggleShuffle);
function toggleRepeat(){isRepeat=!isRepeat;document.getElementById('repeat-btn').classList.toggle('active',isRepeat);document.getElementById('nps-repeat-btn').classList.toggle('active',isRepeat);}
document.getElementById('repeat-btn').addEventListener('click',toggleRepeat);

/* ‚ïê‚ïê AUDIO EVENTS ‚ïê‚ïê */
audios.forEach((audio,i)=>{
    if(!audio)return;
    audio.addEventListener('ended',()=>{isRepeat?audio.play():playNext();});
    audio.addEventListener('loadedmetadata',()=>{if(audio.duration&&!isNaN(audio.duration))setDur(i,audio.duration);});
    audio.addEventListener('timeupdate',()=>{
        if(i!==currentIdx||isDragging)return;
        const dur=audio.duration||0,cur=audio.currentTime;
        const pct=dur?(cur/dur)*100:0;
        const p=pct+'%';
        document.getElementById('prog-fill').style.width=p;
        document.getElementById('prog-thumb').style.left=p;
        document.getElementById('mini-prog-fill').style.width=p;
        document.getElementById('nps-prog-fill').style.width=p;
        document.getElementById('nps-prog-thumb').style.left=p;
        setText('time-current',fmt(cur));setText('time-total',fmt(dur));
        setText('nps-current',fmt(cur));setText('nps-total',fmt(dur));
    });
});

/* ‚ïê‚ïê SEEK ‚ïê‚ïê */
function seekFromX(el,x){
    const r=el.getBoundingClientRect();
    const pct=Math.max(0,Math.min(1,(x-r.left)/r.width));
    if(currentIdx>=0&&audios[currentIdx]){audios[currentIdx].currentTime=pct*(audios[currentIdx].duration||0);}
    const p=(pct*100)+'%';
    document.getElementById('prog-fill').style.width=p;document.getElementById('prog-thumb').style.left=p;
    document.getElementById('mini-prog-fill').style.width=p;
    document.getElementById('nps-prog-fill').style.width=p;document.getElementById('nps-prog-thumb').style.left=p;
}
const progTrack=document.getElementById('prog-track');
progTrack.addEventListener('mousedown',e=>{isDragging=true;seekFromX(progTrack,e.clientX);});
document.addEventListener('mousemove',e=>{if(isDragging)seekFromX(progTrack,e.clientX);});
document.addEventListener('mouseup',()=>{isDragging=false;});
(()=>{
    const outer=document.getElementById('mini-prog-outer');let active=false;
    const getX=e=>e.touches?e.touches[0].clientX:e.clientX;
    outer.addEventListener('touchstart',e=>{active=true;outer.classList.add('drag');seekFromX(outer,getX(e));},{passive:true});
    outer.addEventListener('touchmove',e=>{if(active){e.preventDefault();seekFromX(outer,getX(e));}},{passive:false});
    outer.addEventListener('touchend',()=>{active=false;outer.classList.remove('drag');});
    outer.addEventListener('click',e=>seekFromX(outer,e.clientX));
})();
(()=>{
    const outer=document.getElementById('nps-prog-outer');let active=false;
    const getX=e=>e.touches?e.touches[0].clientX:e.clientX;
    outer.addEventListener('touchstart',e=>{active=true;outer.classList.add('drag');seekFromX(outer,getX(e));},{passive:true});
    outer.addEventListener('touchmove',e=>{if(active){e.preventDefault();seekFromX(outer,getX(e));}},{passive:false});
    outer.addEventListener('touchend',()=>{active=false;outer.classList.remove('drag');});
    outer.addEventListener('click',e=>seekFromX(outer,e.clientX));
})();
(()=>{
    const outer=document.getElementById('nps-vol-outer');
    const doVol=e=>{const r=outer.getBoundingClientRect();const x=e.touches?e.touches[0].clientX:e.clientX;setVol(Math.max(0,Math.min(1,(x-r.left)/r.width)));};
    outer.addEventListener('touchstart',e=>doVol(e),{passive:true});
    outer.addEventListener('touchmove',e=>{e.preventDefault();doVol(e);},{passive:false});
    outer.addEventListener('click',e=>doVol(e));
})();

/* ‚ïê‚ïê VOLUME ‚ïê‚ïê */
function setVol(pct){volume=pct;isMuted=volume===0;document.getElementById('vol-fill').style.width=(volume*100)+'%';document.getElementById('nps-vol-fill').style.width=(volume*100)+'%';setVolAll(volume);updateVolIcon();}
document.getElementById('vol-track').addEventListener('click',e=>{const r=e.currentTarget.getBoundingClientRect();setVol((e.clientX-r.left)/r.width);});
document.getElementById('mute-btn').addEventListener('click',()=>{if(isMuted){isMuted=false;volume=prevVolume||0.7;}else{prevVolume=volume;isMuted=true;volume=0;}document.getElementById('vol-fill').style.width=(volume*100)+'%';document.getElementById('nps-vol-fill').style.width=(volume*100)+'%';setVolAll(volume);updateVolIcon();});
function updateVolIcon(){document.getElementById('vol-icon').className=volume===0?'fas fa-volume-mute':volume<0.5?'fas fa-volume-down':'fas fa-volume-up';}

/* ‚ïê‚ïê LIKE ‚ïê‚ïê */
function toggleLike(e,idx){
    e.stopPropagation();
    likedTracks.has(idx)?likedTracks.delete(idx):likedTracks.add(idx);
    saveLikes(); // ‚úÖ FIX: persist likes
    refreshLikes();updateLikedBadges();
    if(currentView==='liked'){buildLikedList();document.getElementById('hero-count').textContent=`${likedTracks.size} songs`;}
}
function nowLike(){if(currentIdx>=0)toggleLike({stopPropagation:()=>{}},currentIdx);}
document.getElementById('now-like-btn').addEventListener('click',nowLike);
function refreshLikes(){
    const liked=currentIdx>=0&&likedTracks.has(currentIdx);
    ['now-like-btn','nps-like-btn'].forEach(id=>{const btn=document.getElementById(id);if(!btn)return;btn.className=liked?(id.includes('nps')?'nps-like-btn liked':'now-like liked'):(id.includes('nps')?'nps-like-btn':'now-like');btn.innerHTML=liked?'<i class="fas fa-heart"></i>':'<i class="far fa-heart"></i>';});
    TRACKS.forEach((_,i)=>{const btn=document.getElementById(`like-${i}`);if(!btn)return;btn.className=likedTracks.has(i)?'t-like liked':'t-like';btn.innerHTML=likedTracks.has(i)?'<i class="fas fa-heart"></i>':'<i class="far fa-heart"></i>';});
}
function updateLikedBadges(){const n=likedTracks.size;const lc=document.getElementById('liked-count');lc.textContent=n;lc.classList.toggle('show',n>0);document.getElementById('mob-liked-dot').classList.toggle('show',n>0);}

/* ‚ïê‚ïê SEARCH ‚ïê‚ïê */
function runSearch(q){
    if(currentView!=='home')return;
    q=(q||'').toLowerCase().trim();let count=0;
    TRACKS.forEach((_,i)=>{const t=TRACKS[i];const m=!q||t.name.toLowerCase().includes(q)||t.artist.toLowerCase().includes(q)||t.album.toLowerCase().includes(q);document.getElementById(`sidebar-${i}`)?.classList.toggle('hidden',!m);document.getElementById(`track-row-${i}`)?.classList.toggle('hidden',!m);if(m)count++;});
    const b=document.getElementById('count-badge');if(q){b.textContent=`${count} found`;b.classList.add('show');}else b.classList.remove('show');
    document.getElementById('sidebar-no-results').classList.toggle('show',count===0&&!!q);
    document.getElementById('main-no-results').style.display=count===0&&q?'block':'none';
}
document.getElementById('sidebar-search').addEventListener('input',e=>{document.getElementById('s-clear').classList.toggle('show',e.target.value.length>0);document.getElementById('main-search').value=e.target.value;if(currentView!=='home')showHome();runSearch(e.target.value);});
document.getElementById('main-search').addEventListener('input',e=>{document.getElementById('sidebar-search').value=e.target.value;document.getElementById('s-clear').classList.toggle('show',e.target.value.length>0);runSearch(e.target.value);});
document.getElementById('s-clear').addEventListener('click',()=>{document.getElementById('sidebar-search').value='';document.getElementById('main-search').value='';document.getElementById('s-clear').classList.remove('show');runSearch('');});

/* ‚ïê‚ïê MOBILE OVERLAYS ‚ïê‚ïê */
function closeAllMob(){['mob-search-ov','mob-liked-ov','mob-queue-ov','mob-pakhiii-ov'].forEach(id=>document.getElementById(id).classList.remove('open'));}
function openMobSearch(){document.getElementById('mob-search-ov').classList.add('open');document.getElementById('mob-home-btn').classList.remove('active');setTimeout(()=>document.getElementById('mob-search-input').focus(),100);renderMobSearch('');}
function closeMobSearch(){document.getElementById('mob-search-ov').classList.remove('open');document.getElementById('mob-home-btn').classList.add('active');document.getElementById('mob-search-input').value='';}
document.getElementById('mob-search-input').addEventListener('input',e=>renderMobSearch(e.target.value.toLowerCase()));
function renderMobSearch(q){const matched=TRACKS.filter(t=>!q||t.name.toLowerCase().includes(q)||t.artist.toLowerCase().includes(q));const c=document.getElementById('mob-search-results');document.getElementById('mob-search-empty').classList.toggle('show',matched.length===0);c.innerHTML=matched.map(t=>{const i=TRACKS.indexOf(t);return`<div class="mob-result-item" onclick="playSong(${i});closeMobSearch()"><div class="mob-result-art ${t.colorClass}">${t.emoji}</div><div class="mob-result-info"><div class="mob-result-name">${t.name}</div><div class="mob-result-artist">${t.artist}</div></div><div class="mob-result-dur">${t.duration||'‚Äî'}</div></div>`;}).join('');}
function openMobLiked(){document.getElementById('mob-liked-ov').classList.add('open');document.getElementById('mob-home-btn').classList.remove('active');renderMobLiked();}
function closeMobLiked(){document.getElementById('mob-liked-ov').classList.remove('open');document.getElementById('mob-home-btn').classList.add('active');}
function renderMobLiked(){const arr=[...likedTracks];document.getElementById('mob-liked-sub').textContent=`${arr.length} songs`;const c=document.getElementById('mob-liked-list');document.getElementById('mob-liked-empty').classList.toggle('show',arr.length===0);c.innerHTML=arr.map(idx=>{const t=TRACKS[idx];return`<div class="mob-result-item" onclick="playSong(${idx});closeMobLiked()"><div class="mob-result-art ${t.colorClass}">${t.emoji}</div><div class="mob-result-info"><div class="mob-result-name">${t.name}</div><div class="mob-result-artist">${t.artist}</div></div><div class="mob-result-dur">${t.duration||'‚Äî'}</div></div>`;}).join('');}
function openMobPakhiii(){document.getElementById('mob-pakhiii-ov').classList.add('open');document.getElementById('mob-home-btn').classList.remove('active');renderMobPakhiii();}
function closeMobPakhiii(){document.getElementById('mob-pakhiii-ov').classList.remove('open');document.getElementById('mob-home-btn').classList.add('active');}
function renderMobPakhiii(){
    const c=document.getElementById('mob-pakhiii-list');
    document.getElementById('mob-pakhiii-sub').textContent=`${pakhiiiTracks.length} songs`;
    document.getElementById('mob-pakhiii-empty').classList.toggle('show',pakhiiiTracks.length===0);
    c.innerHTML=pakhiiiTracks.map(idx=>{const t=TRACKS[idx];return`
        <div class="mob-result-item" onclick="playSong(${idx});closeMobPakhiii()">
            <div class="mob-result-art ${t.colorClass}">${t.emoji}</div>
            <div class="mob-result-info"><div class="mob-result-name">${t.name}</div><div class="mob-result-artist">${t.artist}</div></div>
            <button style="background:none;border:none;cursor:pointer;color:#ff6666;font-size:.9rem;padding:4px;" onclick="event.stopPropagation();removePakhiii(event,${idx});renderMobPakhiii();"><i class="fas fa-times"></i></button>
        </div>`;}).join('');
}
function openMobQueue(){document.getElementById('mob-queue-ov').classList.add('open');document.getElementById('mob-home-btn').classList.remove('active');renderMobQueue();}
function closeMobQueue(){document.getElementById('mob-queue-ov').classList.remove('open');document.getElementById('mob-home-btn').classList.add('active');}
function renderMobQueue(){
    const items=[];if(currentIdx>=0){if(isShuffle){for(let i=shufflePos;i<Math.min(shufflePos+20,shuffleQ.length);i++)items.push({idx:shuffleQ[i],pos:i-shufflePos});}else{for(let i=currentIdx;i<Math.min(currentIdx+20,TRACKS.length);i++)items.push({idx:i,pos:i-currentIdx});}}
    document.getElementById('mob-queue-sub').textContent=`${items.length} songs`;
    const c=document.getElementById('mob-queue-list');document.getElementById('mob-queue-empty').classList.toggle('show',items.length===0);
    c.innerHTML=items.map(({idx,pos})=>{const t=TRACKS[idx];return`<div class="mob-result-item" style="${pos===0?'background:rgba(29,185,84,0.08)':''}" onclick="playSong(${idx});closeMobQueue()"><div class="mob-result-art ${t.colorClass}">${t.emoji}</div><div class="mob-result-info"><div class="mob-result-name" style="${pos===0?'color:var(--green)':''}">${pos===0?'‚ñ∂ ':''}${t.name}</div><div class="mob-result-artist">${t.artist}</div></div><div class="mob-result-dur">${t.duration||'‚Äî'}</div></div>`;}).join('');
}

/* ‚ïê‚ïê NPS ‚ïê‚ïê */
function openNPS(){document.getElementById('nps').classList.add('open');}
function closeNPS(){document.getElementById('nps').classList.remove('open');}

/* ‚ïê‚ïê KEYBOARD ‚ïê‚ïê */
document.addEventListener('keydown',e=>{
    if(e.target.tagName==='INPUT')return;
    if(e.code==='Space'){e.preventDefault();document.getElementById('play-pause-btn').click();}
    if(e.code==='ArrowRight')playNext();if(e.code==='ArrowLeft')playPrev();
    if(e.code==='KeyS')toggleShuffle();if(e.code==='KeyR')toggleRepeat();
    if(e.code==='KeyL'&&currentIdx>=0)nowLike();
    if(e.code==='Escape'){closeNPS();document.getElementById('eq-panel').classList.remove('open');document.getElementById('sleep-panel').classList.remove('open');}
});

document.addEventListener('click',e=>{
    if(!e.target.closest('#eq-panel')&&!e.target.closest('#eq-btn'))document.getElementById('eq-panel').classList.remove('open');
    if(!e.target.closest('#sleep-panel')&&!e.target.closest('#sleep-btn'))document.getElementById('sleep-panel').classList.remove('open');
});

function fmt(sec){if(!sec||isNaN(sec)||sec===Infinity)return'‚Äî';return`${Math.floor(sec/60)}:${String(Math.floor(sec%60)).padStart(2,'0')}`;}

/* ‚ïê‚ïê INIT ‚ïê‚ïê */
buildSidebar();buildHomeList();buildEqUI();showHome();
updateLikedBadges();updatePakhiiiBadges();refreshLikes();
setTimeout(preloadDurations,400);
</script>
</body>
</html>